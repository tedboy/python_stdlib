

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>nntplib &mdash; Python Standard Library</title>
  

  
  
    <link rel="shortcut icon" href="../_static/py.png"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Python Standard Library" href="../index.html"/>
        <link rel="up" title="Module code" href="index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Python Standard Library
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../01to10.html">Ch 01 - 10</a></li>
<li class="toctree-l1"><a class="reference internal" href="../11to20.html">Ch 11 - 20</a></li>
<li class="toctree-l1"><a class="reference internal" href="../21to30.html">Ch 21 - 30</a></li>
<li class="toctree-l1"><a class="reference internal" href="../31to37.html">Ch 31 - 37</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_all.html">api</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Python Standard Library</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          













<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>nntplib</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for nntplib</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;An NNTP client class based on RFC 977: Network News Transfer Protocol.</span>

<span class="sd">Example:</span>

<span class="sd">&gt;&gt;&gt; from nntplib import NNTP</span>
<span class="sd">&gt;&gt;&gt; s = NNTP(&#39;news&#39;)</span>
<span class="sd">&gt;&gt;&gt; resp, count, first, last, name = s.group(&#39;comp.lang.python&#39;)</span>
<span class="sd">&gt;&gt;&gt; print &#39;Group&#39;, name, &#39;has&#39;, count, &#39;articles, range&#39;, first, &#39;to&#39;, last</span>
<span class="sd">Group comp.lang.python has 51 articles, range 5770 to 5821</span>
<span class="sd">&gt;&gt;&gt; resp, subs = s.xhdr(&#39;subject&#39;, first + &#39;-&#39; + last)</span>
<span class="sd">&gt;&gt;&gt; resp = s.quit()</span>
<span class="sd">&gt;&gt;&gt;</span>

<span class="sd">Here &#39;resp&#39; is the server response line.</span>
<span class="sd">Error responses are turned into exceptions.</span>

<span class="sd">To post an article from a file:</span>
<span class="sd">&gt;&gt;&gt; f = open(filename, &#39;r&#39;) # file containing article, including header</span>
<span class="sd">&gt;&gt;&gt; resp = s.post(f)</span>
<span class="sd">&gt;&gt;&gt;</span>

<span class="sd">For descriptions of all methods, read the comments in the code below.</span>
<span class="sd">Note that all arguments and return values representing article numbers</span>
<span class="sd">are strings, not numbers, since they are rarely used for calculations.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># RFC 977 by Brian Kantor and Phil Lapsley.</span>
<span class="c1"># xover, xgtitle, xpath, date methods by Kevan Heydon</span>


<span class="c1"># Imports</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;NNTP&quot;</span><span class="p">,</span><span class="s2">&quot;NNTPReplyError&quot;</span><span class="p">,</span><span class="s2">&quot;NNTPTemporaryError&quot;</span><span class="p">,</span>
           <span class="s2">&quot;NNTPPermanentError&quot;</span><span class="p">,</span><span class="s2">&quot;NNTPProtocolError&quot;</span><span class="p">,</span><span class="s2">&quot;NNTPDataError&quot;</span><span class="p">,</span>
           <span class="s2">&quot;error_reply&quot;</span><span class="p">,</span><span class="s2">&quot;error_temp&quot;</span><span class="p">,</span><span class="s2">&quot;error_perm&quot;</span><span class="p">,</span><span class="s2">&quot;error_proto&quot;</span><span class="p">,</span>
           <span class="s2">&quot;error_data&quot;</span><span class="p">,]</span>

<span class="c1"># maximal line length when calling readline(). This is to prevent</span>
<span class="c1"># reading arbitrary length lines. RFC 3977 limits NNTP line length to</span>
<span class="c1"># 512 characters, including CRLF. We have selected 2048 just to be on</span>
<span class="c1"># the safe side.</span>
<span class="n">_MAXLINE</span> <span class="o">=</span> <span class="mi">2048</span>


<span class="c1"># Exceptions raised when an error or invalid response is received</span>
<div class="viewcode-block" id="NNTPError"><a class="viewcode-back" href="../generated/nntplib.NNTPError.html#nntplib.NNTPError">[docs]</a><span class="k">class</span> <span class="nc">NNTPError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for all nntplib exceptions&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="ne">Exception</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="s1">&#39;No response given&#39;</span></div>

<div class="viewcode-block" id="NNTPReplyError"><a class="viewcode-back" href="../generated/nntplib.NNTPReplyError.html#nntplib.NNTPReplyError">[docs]</a><span class="k">class</span> <span class="nc">NNTPReplyError</span><span class="p">(</span><span class="n">NNTPError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Unexpected [123]xx reply&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="NNTPTemporaryError"><a class="viewcode-back" href="../generated/nntplib.NNTPTemporaryError.html#nntplib.NNTPTemporaryError">[docs]</a><span class="k">class</span> <span class="nc">NNTPTemporaryError</span><span class="p">(</span><span class="n">NNTPError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;4xx errors&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="NNTPPermanentError"><a class="viewcode-back" href="../generated/nntplib.NNTPPermanentError.html#nntplib.NNTPPermanentError">[docs]</a><span class="k">class</span> <span class="nc">NNTPPermanentError</span><span class="p">(</span><span class="n">NNTPError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;5xx errors&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="NNTPProtocolError"><a class="viewcode-back" href="../generated/nntplib.NNTPProtocolError.html#nntplib.NNTPProtocolError">[docs]</a><span class="k">class</span> <span class="nc">NNTPProtocolError</span><span class="p">(</span><span class="n">NNTPError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Response does not begin with [1-5]&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="NNTPDataError"><a class="viewcode-back" href="../generated/nntplib.NNTPDataError.html#nntplib.NNTPDataError">[docs]</a><span class="k">class</span> <span class="nc">NNTPDataError</span><span class="p">(</span><span class="n">NNTPError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Error in response data&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>

<span class="c1"># for backwards compatibility</span>
<span class="n">error_reply</span> <span class="o">=</span> <span class="n">NNTPReplyError</span>
<span class="n">error_temp</span> <span class="o">=</span> <span class="n">NNTPTemporaryError</span>
<span class="n">error_perm</span> <span class="o">=</span> <span class="n">NNTPPermanentError</span>
<span class="n">error_proto</span> <span class="o">=</span> <span class="n">NNTPProtocolError</span>
<span class="n">error_data</span> <span class="o">=</span> <span class="n">NNTPDataError</span>



<span class="c1"># Standard port used by NNTP servers</span>
<span class="n">NNTP_PORT</span> <span class="o">=</span> <span class="mi">119</span>


<span class="c1"># Response numbers that are followed by additional text (e.g. article)</span>
<span class="n">LONGRESP</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;100&#39;</span><span class="p">,</span> <span class="s1">&#39;215&#39;</span><span class="p">,</span> <span class="s1">&#39;220&#39;</span><span class="p">,</span> <span class="s1">&#39;221&#39;</span><span class="p">,</span> <span class="s1">&#39;222&#39;</span><span class="p">,</span> <span class="s1">&#39;224&#39;</span><span class="p">,</span> <span class="s1">&#39;230&#39;</span><span class="p">,</span> <span class="s1">&#39;231&#39;</span><span class="p">,</span> <span class="s1">&#39;282&#39;</span><span class="p">]</span>


<span class="c1"># Line terminators (we always output CRLF, but accept any of CRLF, CR, LF)</span>
<span class="n">CRLF</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span>



<span class="c1"># The class itself</span>
<div class="viewcode-block" id="NNTP"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.html#nntplib.NNTP">[docs]</a><span class="k">class</span> <span class="nc">NNTP</span><span class="p">:</span>
<div class="viewcode-block" id="NNTP.__init__"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.__init__.html#nntplib.NNTP.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">NNTP_PORT</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">readermode</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">usenetrc</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize an instance.  Arguments:</span>
<span class="sd">        - host: hostname to connect to</span>
<span class="sd">        - port: port to connect to (default the standard NNTP port)</span>
<span class="sd">        - user: username to authenticate with</span>
<span class="sd">        - password: password to use with username</span>
<span class="sd">        - readermode: if true, send &#39;mode reader&#39; command after</span>
<span class="sd">                      connecting.</span>

<span class="sd">        readermode is sometimes necessary if you are connecting to an</span>
<span class="sd">        NNTP server on the local machine and intend to call</span>
<span class="sd">        reader-specific commands, such as `group&#39;.  If you get</span>
<span class="sd">        unexpected NNTPPermanentErrors, you might need to set</span>
<span class="sd">        readermode.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">create_connection</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">makefile</span><span class="p">(</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugging</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">welcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getresp</span><span class="p">()</span>

        <span class="c1"># &#39;mode reader&#39; is sometimes necessary to enable &#39;reader&#39; mode.</span>
        <span class="c1"># However, the order in which &#39;mode reader&#39; and &#39;authinfo&#39; need to</span>
        <span class="c1"># arrive differs between some NNTP servers. Try to send</span>
        <span class="c1"># &#39;mode reader&#39;, and if it fails with an authorization failed</span>
        <span class="c1"># error, try again after sending authinfo.</span>
        <span class="n">readermode_afterauth</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">readermode</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">welcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortcmd</span><span class="p">(</span><span class="s1">&#39;mode reader&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">NNTPPermanentError</span><span class="p">:</span>
                <span class="c1"># error 500, probably &#39;not implemented&#39;</span>
                <span class="k">pass</span>
            <span class="k">except</span> <span class="n">NNTPTemporaryError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">user</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;480&#39;</span><span class="p">:</span>
                    <span class="c1"># Need authorization before &#39;mode reader&#39;</span>
                    <span class="n">readermode_afterauth</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span>
        <span class="c1"># If no login/password was specified, try to get them from ~/.netrc</span>
        <span class="c1"># Presume that if .netc has an entry, NNRP authentication is required.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">usenetrc</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">netrc</span>
                <span class="n">credentials</span> <span class="o">=</span> <span class="n">netrc</span><span class="o">.</span><span class="n">netrc</span><span class="p">()</span>
                <span class="n">auth</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">authenticators</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">auth</span><span class="p">:</span>
                    <span class="n">user</span> <span class="o">=</span> <span class="n">auth</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">password</span> <span class="o">=</span> <span class="n">auth</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c1"># Perform NNRP authentication if needed.</span>
        <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortcmd</span><span class="p">(</span><span class="s1">&#39;authinfo user &#39;</span><span class="o">+</span><span class="n">user</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">resp</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;381&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">password</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">NNTPReplyError</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortcmd</span><span class="p">(</span>
                            <span class="s1">&#39;authinfo pass &#39;</span><span class="o">+</span><span class="n">password</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">resp</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;281&#39;</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">NNTPPermanentError</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">readermode_afterauth</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">welcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortcmd</span><span class="p">(</span><span class="s1">&#39;mode reader&#39;</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">NNTPPermanentError</span><span class="p">:</span>
                    <span class="c1"># error 500, probably &#39;not implemented&#39;</span>
                    <span class="k">pass</span></div>


    <span class="c1"># Get the welcome message from the server</span>
    <span class="c1"># (this is read and squirreled away by __init__()).</span>
    <span class="c1"># If the response code is 200, posting is allowed;</span>
    <span class="c1"># if it 201, posting is not allowed</span>

<div class="viewcode-block" id="NNTP.getwelcome"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.getwelcome.html#nntplib.NNTP.getwelcome">[docs]</a>    <span class="k">def</span> <span class="nf">getwelcome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the welcome message from the server</span>
<span class="sd">        (this is read and squirreled away by __init__()).</span>
<span class="sd">        If the response code is 200, posting is allowed;</span>
<span class="sd">        if it 201, posting is not allowed.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debugging</span><span class="p">:</span> <span class="k">print</span> <span class="s1">&#39;*welcome*&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">welcome</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">welcome</span></div>

<div class="viewcode-block" id="NNTP.set_debuglevel"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.set_debuglevel.html#nntplib.NNTP.set_debuglevel">[docs]</a>    <span class="k">def</span> <span class="nf">set_debuglevel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the debugging level.  Argument &#39;level&#39; means:</span>
<span class="sd">        0: no debugging output (default)</span>
<span class="sd">        1: print commands and responses but not body text etc.</span>
<span class="sd">        2: also print raw lines read and sent before stripping CR/LF&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">debugging</span> <span class="o">=</span> <span class="n">level</span></div>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">set_debuglevel</span>

<div class="viewcode-block" id="NNTP.putline"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.putline.html#nntplib.NNTP.putline">[docs]</a>    <span class="k">def</span> <span class="nf">putline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal: send one line to the server, appending CRLF.&quot;&quot;&quot;</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span> <span class="o">+</span> <span class="n">CRLF</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debugging</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="k">print</span> <span class="s1">&#39;*put*&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></div>

<div class="viewcode-block" id="NNTP.putcmd"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.putcmd.html#nntplib.NNTP.putcmd">[docs]</a>    <span class="k">def</span> <span class="nf">putcmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal: send one command to the server (through putline()).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debugging</span><span class="p">:</span> <span class="k">print</span> <span class="s1">&#39;*cmd*&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">putline</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></div>

<div class="viewcode-block" id="NNTP.getline"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.getline.html#nntplib.NNTP.getline">[docs]</a>    <span class="k">def</span> <span class="nf">getline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal: return one line from the server, stripping CRLF.</span>
<span class="sd">        Raise EOFError if the connection is closed.&quot;&quot;&quot;</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="n">_MAXLINE</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">_MAXLINE</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NNTPDataError</span><span class="p">(</span><span class="s1">&#39;line too long&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debugging</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;*get*&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">EOFError</span>
        <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="n">CRLF</span><span class="p">:</span> <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="ow">in</span> <span class="n">CRLF</span><span class="p">:</span> <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">line</span></div>

<div class="viewcode-block" id="NNTP.getresp"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.getresp.html#nntplib.NNTP.getresp">[docs]</a>    <span class="k">def</span> <span class="nf">getresp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal: get a response from the server.</span>
<span class="sd">        Raise various errors if the response indicates an error.&quot;&quot;&quot;</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getline</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debugging</span><span class="p">:</span> <span class="k">print</span> <span class="s1">&#39;*resp*&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;4&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NNTPTemporaryError</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;5&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NNTPPermanentError</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s1">&#39;123&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NNTPProtocolError</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span></div>

<div class="viewcode-block" id="NNTP.getlongresp"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.getlongresp.html#nntplib.NNTP.getlongresp">[docs]</a>    <span class="k">def</span> <span class="nf">getlongresp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal: get a response plus following text from the server.</span>
<span class="sd">        Raise various errors if the response indicates an error.&quot;&quot;&quot;</span>

        <span class="n">openedFile</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># If a string was passed then open a file with that name</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">openedFile</span> <span class="o">=</span> <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>

            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getresp</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">resp</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">LONGRESP</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NNTPReplyError</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
            <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getline</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="n">line</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;..&#39;</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">if</span> <span class="nb">file</span><span class="p">:</span>
                    <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># If this method created the file, then it must close it</span>
            <span class="k">if</span> <span class="n">openedFile</span><span class="p">:</span>
                <span class="n">openedFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">resp</span><span class="p">,</span> <span class="nb">list</span></div>

<div class="viewcode-block" id="NNTP.shortcmd"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.shortcmd.html#nntplib.NNTP.shortcmd">[docs]</a>    <span class="k">def</span> <span class="nf">shortcmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal: send a command and get the response.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">putcmd</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getresp</span><span class="p">()</span></div>

<div class="viewcode-block" id="NNTP.longcmd"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.longcmd.html#nntplib.NNTP.longcmd">[docs]</a>    <span class="k">def</span> <span class="nf">longcmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal: send a command and get the response plus following text.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">putcmd</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getlongresp</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span></div>

<div class="viewcode-block" id="NNTP.newgroups"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.newgroups.html#nntplib.NNTP.newgroups">[docs]</a>    <span class="k">def</span> <span class="nf">newgroups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process a NEWGROUPS command.  Arguments:</span>
<span class="sd">        - date: string &#39;yymmdd&#39; indicating the date</span>
<span class="sd">        - time: string &#39;hhmmss&#39; indicating the time</span>
<span class="sd">        Return:</span>
<span class="sd">        - resp: server response if successful</span>
<span class="sd">        - list: list of newsgroup names&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">longcmd</span><span class="p">(</span><span class="s1">&#39;NEWGROUPS &#39;</span> <span class="o">+</span> <span class="n">date</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">time</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span></div>

<div class="viewcode-block" id="NNTP.newnews"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.newnews.html#nntplib.NNTP.newnews">[docs]</a>    <span class="k">def</span> <span class="nf">newnews</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process a NEWNEWS command.  Arguments:</span>
<span class="sd">        - group: group name or &#39;*&#39;</span>
<span class="sd">        - date: string &#39;yymmdd&#39; indicating the date</span>
<span class="sd">        - time: string &#39;hhmmss&#39; indicating the time</span>
<span class="sd">        Return:</span>
<span class="sd">        - resp: server response if successful</span>
<span class="sd">        - list: list of message ids&quot;&quot;&quot;</span>

        <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;NEWNEWS &#39;</span> <span class="o">+</span> <span class="n">group</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">date</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">time</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">longcmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span></div>

<div class="viewcode-block" id="NNTP.list"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.list.html#nntplib.NNTP.list">[docs]</a>    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process a LIST command.  Return:</span>
<span class="sd">        - resp: server response if successful</span>
<span class="sd">        - list: list of (group, last, first, flag) (strings)&quot;&quot;&quot;</span>

        <span class="n">resp</span><span class="p">,</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">longcmd</span><span class="p">(</span><span class="s1">&#39;LIST&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">)):</span>
            <span class="c1"># Parse lines into &quot;group last first flag&quot;</span>
            <span class="nb">list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">resp</span><span class="p">,</span> <span class="nb">list</span></div>

<div class="viewcode-block" id="NNTP.description"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.description.html#nntplib.NNTP.description">[docs]</a>    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Get a description for a single group.  If more than one</span>
<span class="sd">        group matches (&#39;group&#39; is a pattern), return the first.  If no</span>
<span class="sd">        group matches, return an empty string.</span>

<span class="sd">        This elides the response code from the server, since it can</span>
<span class="sd">        only be &#39;215&#39; or &#39;285&#39; (for xgtitle) anyway.  If the response</span>
<span class="sd">        code is needed, use the &#39;descriptions&#39; method.</span>

<span class="sd">        NOTE: This neither checks for a wildcard in &#39;group&#39; nor does</span>
<span class="sd">        it check whether the group actually exists.&quot;&quot;&quot;</span>

        <span class="n">resp</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptions</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="NNTP.descriptions"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.descriptions.html#nntplib.NNTP.descriptions">[docs]</a>    <span class="k">def</span> <span class="nf">descriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_pattern</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get descriptions for a range of groups.&quot;&quot;&quot;</span>
        <span class="n">line_pat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;^(?P&lt;group&gt;[^ </span><span class="se">\t</span><span class="s2">]+)[ </span><span class="se">\t</span><span class="s2">]+(.*)$&quot;</span><span class="p">)</span>
        <span class="c1"># Try the more std (acc. to RFC2980) LIST NEWSGROUPS first</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">raw_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">longcmd</span><span class="p">(</span><span class="s1">&#39;LIST NEWSGROUPS &#39;</span> <span class="o">+</span> <span class="n">group_pattern</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resp</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;215&quot;</span><span class="p">:</span>
            <span class="c1"># Now the deprecated XGTITLE.  This either raises an error</span>
            <span class="c1"># or succeeds with the same output structure as LIST</span>
            <span class="c1"># NEWSGROUPS.</span>
            <span class="n">resp</span><span class="p">,</span> <span class="n">raw_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">longcmd</span><span class="p">(</span><span class="s1">&#39;XGTITLE &#39;</span> <span class="o">+</span> <span class="n">group_pattern</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">raw_line</span> <span class="ow">in</span> <span class="n">raw_lines</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">line_pat</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">raw_line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">resp</span><span class="p">,</span> <span class="n">lines</span></div>

<div class="viewcode-block" id="NNTP.group"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.group.html#nntplib.NNTP.group">[docs]</a>    <span class="k">def</span> <span class="nf">group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process a GROUP command.  Argument:</span>
<span class="sd">        - group: the group name</span>
<span class="sd">        Returns:</span>
<span class="sd">        - resp: server response if successful</span>
<span class="sd">        - count: number of articles (string)</span>
<span class="sd">        - first: first article number (string)</span>
<span class="sd">        - last: last article number (string)</span>
<span class="sd">        - name: the group name&quot;&quot;&quot;</span>

        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortcmd</span><span class="p">(</span><span class="s1">&#39;GROUP &#39;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resp</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;211&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NNTPReplyError</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
        <span class="n">words</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">first</span> <span class="o">=</span> <span class="n">last</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">first</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">last</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">resp</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="n">name</span></div>

<div class="viewcode-block" id="NNTP.help"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.help.html#nntplib.NNTP.help">[docs]</a>    <span class="k">def</span> <span class="nf">help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process a HELP command.  Returns:</span>
<span class="sd">        - resp: server response if successful</span>
<span class="sd">        - list: list of strings&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">longcmd</span><span class="p">(</span><span class="s1">&#39;HELP&#39;</span><span class="p">,</span><span class="nb">file</span><span class="p">)</span></div>

<div class="viewcode-block" id="NNTP.statparse"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.statparse.html#nntplib.NNTP.statparse">[docs]</a>    <span class="k">def</span> <span class="nf">statparse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal: parse the response of a STAT, NEXT or LAST command.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">resp</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;22&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NNTPReplyError</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
        <span class="n">words</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">nr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">nr</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">resp</span><span class="p">,</span> <span class="n">nr</span><span class="p">,</span> <span class="nb">id</span></div>

<div class="viewcode-block" id="NNTP.statcmd"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.statcmd.html#nntplib.NNTP.statcmd">[docs]</a>    <span class="k">def</span> <span class="nf">statcmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal: process a STAT, NEXT or LAST command.&quot;&quot;&quot;</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortcmd</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">statparse</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span></div>

<div class="viewcode-block" id="NNTP.stat"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.stat.html#nntplib.NNTP.stat">[docs]</a>    <span class="k">def</span> <span class="nf">stat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process a STAT command.  Argument:</span>
<span class="sd">        - id: article number or message id</span>
<span class="sd">        Returns:</span>
<span class="sd">        - resp: server response if successful</span>
<span class="sd">        - nr:   the article number</span>
<span class="sd">        - id:   the message id&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">statcmd</span><span class="p">(</span><span class="s1">&#39;STAT &#39;</span> <span class="o">+</span> <span class="nb">id</span><span class="p">)</span></div>

<div class="viewcode-block" id="NNTP.next"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.next.html#nntplib.NNTP.next">[docs]</a>    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process a NEXT command.  No arguments.  Return as for STAT.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">statcmd</span><span class="p">(</span><span class="s1">&#39;NEXT&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NNTP.last"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.last.html#nntplib.NNTP.last">[docs]</a>    <span class="k">def</span> <span class="nf">last</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process a LAST command.  No arguments.  Return as for STAT.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">statcmd</span><span class="p">(</span><span class="s1">&#39;LAST&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NNTP.artcmd"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.artcmd.html#nntplib.NNTP.artcmd">[docs]</a>    <span class="k">def</span> <span class="nf">artcmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal: process a HEAD, BODY or ARTICLE command.&quot;&quot;&quot;</span>
        <span class="n">resp</span><span class="p">,</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">longcmd</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">nr</span><span class="p">,</span> <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statparse</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span><span class="p">,</span> <span class="n">nr</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="nb">list</span></div>

<div class="viewcode-block" id="NNTP.head"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.head.html#nntplib.NNTP.head">[docs]</a>    <span class="k">def</span> <span class="nf">head</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process a HEAD command.  Argument:</span>
<span class="sd">        - id: article number or message id</span>
<span class="sd">        Returns:</span>
<span class="sd">        - resp: server response if successful</span>
<span class="sd">        - nr: article number</span>
<span class="sd">        - id: message id</span>
<span class="sd">        - list: the lines of the article&#39;s header&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">artcmd</span><span class="p">(</span><span class="s1">&#39;HEAD &#39;</span> <span class="o">+</span> <span class="nb">id</span><span class="p">)</span></div>

<div class="viewcode-block" id="NNTP.body"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.body.html#nntplib.NNTP.body">[docs]</a>    <span class="k">def</span> <span class="nf">body</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process a BODY command.  Argument:</span>
<span class="sd">        - id: article number or message id</span>
<span class="sd">        - file: Filename string or file object to store the article in</span>
<span class="sd">        Returns:</span>
<span class="sd">        - resp: server response if successful</span>
<span class="sd">        - nr: article number</span>
<span class="sd">        - id: message id</span>
<span class="sd">        - list: the lines of the article&#39;s body or an empty list</span>
<span class="sd">                if file was used&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">artcmd</span><span class="p">(</span><span class="s1">&#39;BODY &#39;</span> <span class="o">+</span> <span class="nb">id</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span></div>

<div class="viewcode-block" id="NNTP.article"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.article.html#nntplib.NNTP.article">[docs]</a>    <span class="k">def</span> <span class="nf">article</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process an ARTICLE command.  Argument:</span>
<span class="sd">        - id: article number or message id</span>
<span class="sd">        Returns:</span>
<span class="sd">        - resp: server response if successful</span>
<span class="sd">        - nr: article number</span>
<span class="sd">        - id: message id</span>
<span class="sd">        - list: the lines of the article&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">artcmd</span><span class="p">(</span><span class="s1">&#39;ARTICLE &#39;</span> <span class="o">+</span> <span class="nb">id</span><span class="p">)</span></div>

<div class="viewcode-block" id="NNTP.slave"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.slave.html#nntplib.NNTP.slave">[docs]</a>    <span class="k">def</span> <span class="nf">slave</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process a SLAVE command.  Returns:</span>
<span class="sd">        - resp: server response if successful&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortcmd</span><span class="p">(</span><span class="s1">&#39;SLAVE&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NNTP.xhdr"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.xhdr.html#nntplib.NNTP.xhdr">[docs]</a>    <span class="k">def</span> <span class="nf">xhdr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hdr</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process an XHDR command (optional server extension).  Arguments:</span>
<span class="sd">        - hdr: the header type (e.g. &#39;subject&#39;)</span>
<span class="sd">        - str: an article nr, a message id, or a range nr1-nr2</span>
<span class="sd">        Returns:</span>
<span class="sd">        - resp: server response if successful</span>
<span class="sd">        - list: list of (nr, value) strings&quot;&quot;&quot;</span>

        <span class="n">pat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;^([0-9]+) ?(.*)</span><span class="se">\n</span><span class="s1">?&#39;</span><span class="p">)</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">longcmd</span><span class="p">(</span><span class="s1">&#39;XHDR &#39;</span> <span class="o">+</span> <span class="n">hdr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">pat</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span><span class="p">,</span> <span class="n">lines</span></div>

<div class="viewcode-block" id="NNTP.xover"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.xover.html#nntplib.NNTP.xover">[docs]</a>    <span class="k">def</span> <span class="nf">xover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process an XOVER command (optional server extension) Arguments:</span>
<span class="sd">        - start: start of range</span>
<span class="sd">        - end: end of range</span>
<span class="sd">        Returns:</span>
<span class="sd">        - resp: server response if successful</span>
<span class="sd">        - list: list of (art-nr, subject, poster, date,</span>
<span class="sd">                         id, references, size, lines)&quot;&quot;&quot;</span>

        <span class="n">resp</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">longcmd</span><span class="p">(</span><span class="s1">&#39;XOVER &#39;</span> <span class="o">+</span> <span class="n">start</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">end</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span>
        <span class="n">xover_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">elem</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">xover_lines</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                    <span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                    <span class="n">elem</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                    <span class="n">elem</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                                    <span class="n">elem</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                                    <span class="n">elem</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span>
                                    <span class="n">elem</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
                                    <span class="n">elem</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NNTPDataError</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span><span class="p">,</span><span class="n">xover_lines</span></div>

<div class="viewcode-block" id="NNTP.xgtitle"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.xgtitle.html#nntplib.NNTP.xgtitle">[docs]</a>    <span class="k">def</span> <span class="nf">xgtitle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process an XGTITLE command (optional server extension) Arguments:</span>
<span class="sd">        - group: group name wildcard (i.e. news.*)</span>
<span class="sd">        Returns:</span>
<span class="sd">        - resp: server response if successful</span>
<span class="sd">        - list: list of (name,title) strings&quot;&quot;&quot;</span>

        <span class="n">line_pat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;^([^ </span><span class="se">\t</span><span class="s2">]+)[ </span><span class="se">\t</span><span class="s2">]+(.*)$&quot;</span><span class="p">)</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">raw_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">longcmd</span><span class="p">(</span><span class="s1">&#39;XGTITLE &#39;</span> <span class="o">+</span> <span class="n">group</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">raw_line</span> <span class="ow">in</span> <span class="n">raw_lines</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">line_pat</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">raw_line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">resp</span><span class="p">,</span> <span class="n">lines</span></div>

<div class="viewcode-block" id="NNTP.xpath"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.xpath.html#nntplib.NNTP.xpath">[docs]</a>    <span class="k">def</span> <span class="nf">xpath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process an XPATH command (optional server extension) Arguments:</span>
<span class="sd">        - id: Message id of article</span>
<span class="sd">        Returns:</span>
<span class="sd">        resp: server response if successful</span>
<span class="sd">        path: directory path to article&quot;&quot;&quot;</span>

        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortcmd</span><span class="p">(</span><span class="s2">&quot;XPATH &quot;</span> <span class="o">+</span> <span class="nb">id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resp</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;223&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NNTPReplyError</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="p">[</span><span class="n">resp_num</span><span class="p">,</span> <span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NNTPReplyError</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">resp</span><span class="p">,</span> <span class="n">path</span></div>

<div class="viewcode-block" id="NNTP.date"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.date.html#nntplib.NNTP.date">[docs]</a>    <span class="k">def</span> <span class="nf">date</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process the DATE command. Arguments:</span>
<span class="sd">        None</span>
<span class="sd">        Returns:</span>
<span class="sd">        resp: server response if successful</span>
<span class="sd">        date: Date suitable for newnews/newgroups commands etc.</span>
<span class="sd">        time: Time suitable for newnews/newgroups commands etc.&quot;&quot;&quot;</span>

        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortcmd</span><span class="p">(</span><span class="s2">&quot;DATE&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resp</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;111&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NNTPReplyError</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
        <span class="n">elem</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NNTPDataError</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">6</span><span class="p">:]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">date</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">6</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">6</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NNTPDataError</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">time</span></div>


<div class="viewcode-block" id="NNTP.post"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.post.html#nntplib.NNTP.post">[docs]</a>    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process a POST command.  Arguments:</span>
<span class="sd">        - f: file containing the article</span>
<span class="sd">        Returns:</span>
<span class="sd">        - resp: server response if successful&quot;&quot;&quot;</span>

        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortcmd</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">)</span>
        <span class="c1"># Raises error_??? if posting is not allowed</span>
        <span class="k">if</span> <span class="n">resp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NNTPReplyError</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">line</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">putline</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">putline</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getresp</span><span class="p">()</span></div>

<div class="viewcode-block" id="NNTP.ihave"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.ihave.html#nntplib.NNTP.ihave">[docs]</a>    <span class="k">def</span> <span class="nf">ihave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process an IHAVE command.  Arguments:</span>
<span class="sd">        - id: message-id of the article</span>
<span class="sd">        - f:  file containing the article</span>
<span class="sd">        Returns:</span>
<span class="sd">        - resp: server response if successful</span>
<span class="sd">        Note that if the server refuses the article an exception is raised.&quot;&quot;&quot;</span>

        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortcmd</span><span class="p">(</span><span class="s1">&#39;IHAVE &#39;</span> <span class="o">+</span> <span class="nb">id</span><span class="p">)</span>
        <span class="c1"># Raises error_??? if the server already has it</span>
        <span class="k">if</span> <span class="n">resp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NNTPReplyError</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">line</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">putline</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">putline</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getresp</span><span class="p">()</span></div>

<div class="viewcode-block" id="NNTP.quit"><a class="viewcode-back" href="../generated/generated/nntplib.NNTP.quit.html#nntplib.NNTP.quit">[docs]</a>    <span class="k">def</span> <span class="nf">quit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process a QUIT command and close the socket.  Returns:</span>
<span class="sd">        - resp: server response if successful&quot;&quot;&quot;</span>

        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortcmd</span><span class="p">(</span><span class="s1">&#39;QUIT&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span>
        <span class="k">return</span> <span class="n">resp</span></div></div>


<span class="c1"># Test retrieval when run as a script.</span>
<span class="c1"># Assumption: if there&#39;s a local news server, it&#39;s called &#39;news&#39;.</span>
<span class="c1"># Assumption: if user queries a remote news server, it&#39;s named</span>
<span class="c1"># in the environment variable NNTPSERVER (used by slrn and kin)</span>
<span class="c1"># and we want readermode off.</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="n">newshost</span> <span class="o">=</span> <span class="s1">&#39;news&#39;</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;NNTPSERVER&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">newshost</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;readermode&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">NNTP</span><span class="p">(</span><span class="n">newshost</span><span class="p">,</span> <span class="n">readermode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
    <span class="n">resp</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;comp.lang.python&#39;</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">resp</span>
    <span class="k">print</span> <span class="s1">&#39;Group&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;has&#39;</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="s1">&#39;articles, range&#39;</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">,</span> <span class="n">last</span>
    <span class="n">resp</span><span class="p">,</span> <span class="n">subs</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">xhdr</span><span class="p">(</span><span class="s1">&#39;subject&#39;</span><span class="p">,</span> <span class="n">first</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">last</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">resp</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">subs</span><span class="p">:</span>
        <span class="k">print</span> <span class="s2">&quot;</span><span class="si">%7s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">item</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
    <span class="k">print</span> <span class="n">resp</span>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/copybutton.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>