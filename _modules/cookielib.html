

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>cookielib &mdash; Python Standard Library</title>
  

  
  
    <link rel="shortcut icon" href="../_static/py.png"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Python Standard Library" href="../index.html"/>
        <link rel="up" title="Module code" href="index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Python Standard Library
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../01to10.html">Ch 01 - 10</a></li>
<li class="toctree-l1"><a class="reference internal" href="../11to20.html">Ch 11 - 20</a></li>
<li class="toctree-l1"><a class="reference internal" href="../21to30.html">Ch 21 - 30</a></li>
<li class="toctree-l1"><a class="reference internal" href="../31to37.html">Ch 31 - 37</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_all.html">api</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Python Standard Library</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          













<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>cookielib</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for cookielib</h1><div class="highlight"><pre>
<span></span><span class="sd">r&quot;&quot;&quot;HTTP cookie handling for web clients.</span>

<span class="sd">This module has (now fairly distant) origins in Gisle Aas&#39; Perl module</span>
<span class="sd">HTTP::Cookies, from the libwww-perl library.</span>

<span class="sd">Docstrings, comments and debug strings in this code refer to the</span>
<span class="sd">attributes of the HTTP cookie system as cookie-attributes, to distinguish</span>
<span class="sd">them clearly from Python attributes.</span>

<span class="sd">Class diagram (note that BSDDBCookieJar and the MSIE* classes are not</span>
<span class="sd">distributed with the Python standard library, but are available from</span>
<span class="sd">http://wwwsearch.sf.net/):</span>

<span class="sd">                        CookieJar____</span>
<span class="sd">                        /     \      \</span>
<span class="sd">            FileCookieJar      \      \</span>
<span class="sd">             /    |   \         \      \</span>
<span class="sd"> MozillaCookieJar | LWPCookieJar \      \</span>
<span class="sd">                  |               |      \</span>
<span class="sd">                  |   ---MSIEBase |       \</span>
<span class="sd">                  |  /      |     |        \</span>
<span class="sd">                  | /   MSIEDBCookieJar BSDDBCookieJar</span>
<span class="sd">                  |/</span>
<span class="sd">               MSIECookieJar</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Cookie&#39;</span><span class="p">,</span> <span class="s1">&#39;CookieJar&#39;</span><span class="p">,</span> <span class="s1">&#39;CookiePolicy&#39;</span><span class="p">,</span> <span class="s1">&#39;DefaultCookiePolicy&#39;</span><span class="p">,</span>
           <span class="s1">&#39;FileCookieJar&#39;</span><span class="p">,</span> <span class="s1">&#39;LWPCookieJar&#39;</span><span class="p">,</span> <span class="s1">&#39;lwp_cookie_str&#39;</span><span class="p">,</span> <span class="s1">&#39;LoadError&#39;</span><span class="p">,</span>
           <span class="s1">&#39;MozillaCookieJar&#39;</span><span class="p">]</span>

<span class="kn">import</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">urlparse</span><span class="o">,</span> <span class="nn">copy</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">urllib</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">threading</span> <span class="kn">as</span> <span class="nn">_threading</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">dummy_threading</span> <span class="kn">as</span> <span class="nn">_threading</span>
<span class="kn">import</span> <span class="nn">httplib</span>  <span class="c1"># only for the default HTTP port</span>
<span class="kn">from</span> <span class="nn">calendar</span> <span class="kn">import</span> <span class="n">timegm</span>

<span class="n">debug</span> <span class="o">=</span> <span class="bp">False</span>   <span class="c1"># set to True to enable debugging via the logging module</span>
<span class="n">logger</span> <span class="o">=</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">_debug</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">debug</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">global</span> <span class="n">logger</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">logger</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">logging</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;cookielib&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>


<span class="n">DEFAULT_HTTP_PORT</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">httplib</span><span class="o">.</span><span class="n">HTTP_PORT</span><span class="p">)</span>
<span class="n">MISSING_FILENAME_TEXT</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;a filename was not supplied (nor was the CookieJar &quot;</span>
                         <span class="s2">&quot;instance initialised with one)&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_warn_unhandled_exception</span><span class="p">():</span>
    <span class="c1"># There are a few catch-all except: statements in this module, for</span>
    <span class="c1"># catching input that&#39;s bad in unexpected ways.  Warn if any</span>
    <span class="c1"># exceptions are caught there.</span>
    <span class="kn">import</span> <span class="nn">warnings</span><span class="o">,</span> <span class="nn">traceback</span><span class="o">,</span> <span class="nn">StringIO</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;cookielib bug!</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>


<span class="c1"># Date/time conversion</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="n">EPOCH_YEAR</span> <span class="o">=</span> <span class="mi">1970</span>
<span class="k">def</span> <span class="nf">_timegm</span><span class="p">(</span><span class="n">tt</span><span class="p">):</span>
    <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">mday</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="n">sec</span> <span class="o">=</span> <span class="n">tt</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="n">EPOCH_YEAR</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">month</span> <span class="o">&lt;=</span> <span class="mi">12</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">mday</span> <span class="o">&lt;=</span> <span class="mi">31</span><span class="p">)</span> <span class="ow">and</span>
        <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">hour</span> <span class="o">&lt;=</span> <span class="mi">24</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="nb">min</span> <span class="o">&lt;=</span> <span class="mi">59</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">sec</span> <span class="o">&lt;=</span> <span class="mi">61</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">timegm</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>

<span class="n">DAYS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Mon&quot;</span><span class="p">,</span> <span class="s2">&quot;Tue&quot;</span><span class="p">,</span> <span class="s2">&quot;Wed&quot;</span><span class="p">,</span> <span class="s2">&quot;Thu&quot;</span><span class="p">,</span> <span class="s2">&quot;Fri&quot;</span><span class="p">,</span> <span class="s2">&quot;Sat&quot;</span><span class="p">,</span> <span class="s2">&quot;Sun&quot;</span><span class="p">]</span>
<span class="n">MONTHS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Jan&quot;</span><span class="p">,</span> <span class="s2">&quot;Feb&quot;</span><span class="p">,</span> <span class="s2">&quot;Mar&quot;</span><span class="p">,</span> <span class="s2">&quot;Apr&quot;</span><span class="p">,</span> <span class="s2">&quot;May&quot;</span><span class="p">,</span> <span class="s2">&quot;Jun&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Jul&quot;</span><span class="p">,</span> <span class="s2">&quot;Aug&quot;</span><span class="p">,</span> <span class="s2">&quot;Sep&quot;</span><span class="p">,</span> <span class="s2">&quot;Oct&quot;</span><span class="p">,</span> <span class="s2">&quot;Nov&quot;</span><span class="p">,</span> <span class="s2">&quot;Dec&quot;</span><span class="p">]</span>
<span class="n">MONTHS_LOWER</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">MONTHS</span><span class="p">:</span> <span class="n">MONTHS_LOWER</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">month</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

<div class="viewcode-block" id="time2isoz"><a class="viewcode-back" href="../generated/generated/cookielib.time2isoz.html#cookielib.time2isoz">[docs]</a><span class="k">def</span> <span class="nf">time2isoz</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a string representing time in seconds since epoch, t.</span>

<span class="sd">    If the function is called without an argument, it will use the current</span>
<span class="sd">    time.</span>

<span class="sd">    The format of the returned string is like &quot;YYYY-MM-DD hh:mm:ssZ&quot;,</span>
<span class="sd">    representing Universal Time (UTC, aka GMT).  An example of this format is:</span>

<span class="sd">    1994-11-24 08:49:37Z</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">mday</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="n">sec</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">t</span><span class="p">)[:</span><span class="mi">6</span><span class="p">]</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%04d</span><span class="s2">-</span><span class="si">%02d</span><span class="s2">-</span><span class="si">%02d</span><span class="s2"> </span><span class="si">%02d</span><span class="s2">:</span><span class="si">%02d</span><span class="s2">:</span><span class="si">%02d</span><span class="s2">Z&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">mday</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="n">sec</span><span class="p">)</span></div>

<div class="viewcode-block" id="time2netscape"><a class="viewcode-back" href="../generated/generated/cookielib.time2netscape.html#cookielib.time2netscape">[docs]</a><span class="k">def</span> <span class="nf">time2netscape</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a string representing time in seconds since epoch, t.</span>

<span class="sd">    If the function is called without an argument, it will use the current</span>
<span class="sd">    time.</span>

<span class="sd">    The format of the returned string is like this:</span>

<span class="sd">    Wed, DD-Mon-YYYY HH:MM:SS GMT</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">mday</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="n">wday</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">t</span><span class="p">)[:</span><span class="mi">7</span><span class="p">]</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%02d</span><span class="s2">-</span><span class="si">%s</span><span class="s2">-</span><span class="si">%04d</span><span class="s2"> </span><span class="si">%02d</span><span class="s2">:</span><span class="si">%02d</span><span class="s2">:</span><span class="si">%02d</span><span class="s2"> GMT&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="n">DAYS</span><span class="p">[</span><span class="n">wday</span><span class="p">],</span> <span class="n">mday</span><span class="p">,</span> <span class="n">MONTHS</span><span class="p">[</span><span class="n">mon</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">year</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="n">sec</span><span class="p">)</span></div>


<span class="n">UTC_ZONES</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;GMT&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s2">&quot;UTC&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s2">&quot;UT&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>

<span class="n">TIMEZONE_RE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;^([-+])?(\d\d?):?(\d\d)?$&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="offset_from_tz_string"><a class="viewcode-back" href="../generated/generated/cookielib.offset_from_tz_string.html#cookielib.offset_from_tz_string">[docs]</a><span class="k">def</span> <span class="nf">offset_from_tz_string</span><span class="p">(</span><span class="n">tz</span><span class="p">):</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">tz</span> <span class="ow">in</span> <span class="n">UTC_ZONES</span><span class="p">:</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">TIMEZONE_RE</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">tz</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="mi">3600</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">+</span> <span class="mi">60</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="o">-</span><span class="n">offset</span>
    <span class="k">return</span> <span class="n">offset</span></div>

<span class="k">def</span> <span class="nf">_str2time</span><span class="p">(</span><span class="n">day</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">yr</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="n">tz</span><span class="p">):</span>
    <span class="c1"># translate month name to number</span>
    <span class="c1"># month numbers start with 1 (January)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">mon</span> <span class="o">=</span> <span class="n">MONTHS_LOWER</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">mon</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="c1"># maybe it&#39;s already a number</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">imon</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mon</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">imon</span> <span class="o">&lt;=</span> <span class="mi">12</span><span class="p">:</span>
            <span class="n">mon</span> <span class="o">=</span> <span class="n">imon</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="c1"># make sure clock elements are defined</span>
    <span class="k">if</span> <span class="n">hr</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">hr</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="nb">min</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="nb">min</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">sec</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">sec</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">yr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">yr</span><span class="p">)</span>
    <span class="n">day</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">day</span><span class="p">)</span>
    <span class="n">hr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hr</span><span class="p">)</span>
    <span class="nb">min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">)</span>
    <span class="n">sec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sec</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">yr</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
        <span class="c1"># find &quot;obvious&quot; year</span>
        <span class="n">cur_yr</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">cur_yr</span> <span class="o">%</span> <span class="mi">100</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">yr</span>
        <span class="n">yr</span> <span class="o">=</span> <span class="n">yr</span> <span class="o">+</span> <span class="n">cur_yr</span> <span class="o">-</span> <span class="n">m</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="n">tmp</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">yr</span> <span class="o">=</span> <span class="n">yr</span> <span class="o">+</span> <span class="mi">100</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">yr</span> <span class="o">=</span> <span class="n">yr</span> <span class="o">-</span> <span class="mi">100</span>

    <span class="c1"># convert UTC time tuple to seconds since epoch (not timezone-adjusted)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">_timegm</span><span class="p">((</span><span class="n">yr</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="n">tz</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># adjust time using timezone string, to get absolute time since epoch</span>
        <span class="k">if</span> <span class="n">tz</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">tz</span> <span class="o">=</span> <span class="s2">&quot;UTC&quot;</span>
        <span class="n">tz</span> <span class="o">=</span> <span class="n">tz</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">offset_from_tz_string</span><span class="p">(</span><span class="n">tz</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-</span> <span class="n">offset</span>

    <span class="k">return</span> <span class="n">t</span>

<span class="n">STRICT_DATE_RE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="s2">r&quot;^[SMTWF][a-z][a-z], (\d\d) ([JFMASOND][a-z][a-z]) &quot;</span>
    <span class="s2">&quot;(\d\d\d\d) (\d\d):(\d\d):(\d\d) GMT$&quot;</span><span class="p">)</span>
<span class="n">WEEKDAY_RE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="s2">r&quot;^(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)[a-z]*,?\s*&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
<span class="n">LOOSE_HTTP_DATE_RE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="sd">r&quot;&quot;&quot;^</span>
<span class="sd">    (\d\d?)            # day</span>
<span class="sd">       (?:\s+|[-\/])</span>
<span class="sd">    (\w+)              # month</span>
<span class="sd">        (?:\s+|[-\/])</span>
<span class="sd">    (\d+)              # year</span>
<span class="sd">    (?:</span>
<span class="sd">          (?:\s+|:)    # separator before clock</span>
<span class="sd">       (\d\d?):(\d\d)  # hour:min</span>
<span class="sd">       (?::(\d\d))?    # optional seconds</span>
<span class="sd">    )?                 # optional clock</span>
<span class="sd">       \s*</span>
<span class="sd">    ([-+]?\d{2,4}|(?![APap][Mm]\b)[A-Za-z]+)? # timezone</span>
<span class="sd">       \s*</span>
<span class="sd">    (?:\(\w+\))?       # ASCII representation of timezone in parens.</span>
<span class="sd">       \s*$&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
<div class="viewcode-block" id="http2time"><a class="viewcode-back" href="../generated/generated/cookielib.http2time.html#cookielib.http2time">[docs]</a><span class="k">def</span> <span class="nf">http2time</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns time in seconds since epoch of time represented by a string.</span>

<span class="sd">    Return value is an integer.</span>

<span class="sd">    None is returned if the format of str is unrecognized, the time is outside</span>
<span class="sd">    the representable range, or the timezone string is not recognized.  If the</span>
<span class="sd">    string contains no timezone, UTC is assumed.</span>

<span class="sd">    The timezone in the string may be numerical (like &quot;-0800&quot; or &quot;+0100&quot;) or a</span>
<span class="sd">    string timezone (like &quot;UTC&quot;, &quot;GMT&quot;, &quot;BST&quot; or &quot;EST&quot;).  Currently, only the</span>
<span class="sd">    timezone strings equivalent to UTC (zero offset) are known to the function.</span>

<span class="sd">    The function loosely parses the following formats:</span>

<span class="sd">    Wed, 09 Feb 1994 22:23:32 GMT       -- HTTP format</span>
<span class="sd">    Tuesday, 08-Feb-94 14:15:29 GMT     -- old rfc850 HTTP format</span>
<span class="sd">    Tuesday, 08-Feb-1994 14:15:29 GMT   -- broken rfc850 HTTP format</span>
<span class="sd">    09 Feb 1994 22:23:32 GMT            -- HTTP format (no weekday)</span>
<span class="sd">    08-Feb-94 14:15:29 GMT              -- rfc850 format (no weekday)</span>
<span class="sd">    08-Feb-1994 14:15:29 GMT            -- broken rfc850 format (no weekday)</span>

<span class="sd">    The parser ignores leading and trailing whitespace.  The time may be</span>
<span class="sd">    absent.</span>

<span class="sd">    If the year is given with only 2 digits, the function will select the</span>
<span class="sd">    century that makes the year closest to the current date.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># fast exit for strictly conforming string</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">STRICT_DATE_RE</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
        <span class="n">mon</span> <span class="o">=</span> <span class="n">MONTHS_LOWER</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">tt</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">mon</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
              <span class="nb">int</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">_timegm</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span>

    <span class="c1"># No, we need some messy parsing...</span>

    <span class="c1"># clean up</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">WEEKDAY_RE</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Useless weekday</span>

    <span class="c1"># tz is time zone specifier string</span>
    <span class="n">day</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">yr</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="n">tz</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="mi">7</span>

    <span class="c1"># loose regexp parse</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">LOOSE_HTTP_DATE_RE</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">day</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">yr</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="n">tz</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>  <span class="c1"># bad format</span>

    <span class="k">return</span> <span class="n">_str2time</span><span class="p">(</span><span class="n">day</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">yr</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="n">tz</span><span class="p">)</span></div>

<span class="n">ISO_DATE_RE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="sd">&quot;&quot;&quot;^</span>
<span class="sd">    (\d{4})              # year</span>
<span class="sd">       [-\/]?</span>
<span class="sd">    (\d\d?)              # numerical month</span>
<span class="sd">       [-\/]?</span>
<span class="sd">    (\d\d?)              # day</span>
<span class="sd">   (?:</span>
<span class="sd">         (?:\s+|[-:Tt])  # separator before clock</span>
<span class="sd">      (\d\d?):?(\d\d)    # hour:min</span>
<span class="sd">      (?::?(\d\d(?:\.\d*)?))?  # optional seconds (and fractional)</span>
<span class="sd">   )?                    # optional clock</span>
<span class="sd">      \s*</span>
<span class="sd">   ([-+]?\d\d?:?(:?\d\d)?</span>
<span class="sd">    |Z|z)?               # timezone  (Z is &quot;zero meridian&quot;, i.e. GMT)</span>
<span class="sd">      \s*$&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
<div class="viewcode-block" id="iso2time"><a class="viewcode-back" href="../generated/generated/cookielib.iso2time.html#cookielib.iso2time">[docs]</a><span class="k">def</span> <span class="nf">iso2time</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    As for http2time, but parses the ISO 8601 formats:</span>

<span class="sd">    1994-02-03 14:15:29 -0100    -- ISO 8601 format</span>
<span class="sd">    1994-02-03 14:15:29          -- zone is optional</span>
<span class="sd">    1994-02-03                   -- only date</span>
<span class="sd">    1994-02-03T14:15:29          -- Use T as separator</span>
<span class="sd">    19940203T141529Z             -- ISO 8601 compact format</span>
<span class="sd">    19940203                     -- only date</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># clean up</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>

    <span class="c1"># tz is time zone specifier string</span>
    <span class="n">day</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">yr</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="n">tz</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="mi">7</span>

    <span class="c1"># loose regexp parse</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">ISO_DATE_RE</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># XXX there&#39;s an extra bit of the timezone I&#39;m ignoring here: is</span>
        <span class="c1">#   this the right thing to do?</span>
        <span class="n">yr</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="n">tz</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>  <span class="c1"># bad format</span>

    <span class="k">return</span> <span class="n">_str2time</span><span class="p">(</span><span class="n">day</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">yr</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="n">tz</span><span class="p">)</span></div>


<span class="c1"># Header parsing</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="unmatched"><a class="viewcode-back" href="../generated/generated/cookielib.unmatched.html#cookielib.unmatched">[docs]</a><span class="k">def</span> <span class="nf">unmatched</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return unmatched part of re.Match object.&quot;&quot;&quot;</span>
    <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">span</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">string</span><span class="p">[:</span><span class="n">start</span><span class="p">]</span><span class="o">+</span><span class="n">match</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">end</span><span class="p">:]</span></div>

<span class="n">HEADER_TOKEN_RE</span> <span class="o">=</span>        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;^\s*([^=\s;,]+)&quot;</span><span class="p">)</span>
<span class="n">HEADER_QUOTED_VALUE_RE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;^\s*=\s*</span><span class="se">\&quot;</span><span class="s2">([^</span><span class="se">\&quot;\\</span><span class="s2">]*(?:</span><span class="se">\\</span><span class="s2">.[^</span><span class="se">\&quot;\\</span><span class="s2">]*)*)</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">HEADER_VALUE_RE</span> <span class="o">=</span>        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;^\s*=\s*([^\s;,]*)&quot;</span><span class="p">)</span>
<span class="n">HEADER_ESCAPE_RE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;</span><span class="se">\\</span><span class="s2">(.)&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="split_header_words"><a class="viewcode-back" href="../generated/generated/cookielib.split_header_words.html#cookielib.split_header_words">[docs]</a><span class="k">def</span> <span class="nf">split_header_words</span><span class="p">(</span><span class="n">header_values</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;Parse header values into a list of lists containing key,value pairs.</span>

<span class="sd">    The function knows how to deal with &quot;,&quot;, &quot;;&quot; and &quot;=&quot; as well as quoted</span>
<span class="sd">    values after &quot;=&quot;.  A list of space separated tokens are parsed as if they</span>
<span class="sd">    were separated by &quot;;&quot;.</span>

<span class="sd">    If the header_values passed as argument contains multiple values, then they</span>
<span class="sd">    are treated as if they were a single value separated by comma &quot;,&quot;.</span>

<span class="sd">    This means that this function is useful for parsing header fields that</span>
<span class="sd">    follow this syntax (BNF as from the HTTP/1.1 specification, but we relax</span>
<span class="sd">    the requirement for tokens).</span>

<span class="sd">      headers           = #header</span>
<span class="sd">      header            = (token | parameter) *( [&quot;;&quot;] (token | parameter))</span>

<span class="sd">      token             = 1*&lt;any CHAR except CTLs or separators&gt;</span>
<span class="sd">      separators        = &quot;(&quot; | &quot;)&quot; | &quot;&lt;&quot; | &quot;&gt;&quot; | &quot;@&quot;</span>
<span class="sd">                        | &quot;,&quot; | &quot;;&quot; | &quot;:&quot; | &quot;\&quot; | &lt;&quot;&gt;</span>
<span class="sd">                        | &quot;/&quot; | &quot;[&quot; | &quot;]&quot; | &quot;?&quot; | &quot;=&quot;</span>
<span class="sd">                        | &quot;{&quot; | &quot;}&quot; | SP | HT</span>

<span class="sd">      quoted-string     = ( &lt;&quot;&gt; *(qdtext | quoted-pair ) &lt;&quot;&gt; )</span>
<span class="sd">      qdtext            = &lt;any TEXT except &lt;&quot;&gt;&gt;</span>
<span class="sd">      quoted-pair       = &quot;\&quot; CHAR</span>

<span class="sd">      parameter         = attribute &quot;=&quot; value</span>
<span class="sd">      attribute         = token</span>
<span class="sd">      value             = token | quoted-string</span>

<span class="sd">    Each header is represented by a list of key/value pairs.  The value for a</span>
<span class="sd">    simple token (not part of a parameter) is None.  Syntactically incorrect</span>
<span class="sd">    headers will not necessarily be parsed as you would want.</span>

<span class="sd">    This is easier to describe with some examples:</span>

<span class="sd">    &gt;&gt;&gt; split_header_words([&#39;foo=&quot;bar&quot;; port=&quot;80,81&quot;; discard, bar=baz&#39;])</span>
<span class="sd">    [[(&#39;foo&#39;, &#39;bar&#39;), (&#39;port&#39;, &#39;80,81&#39;), (&#39;discard&#39;, None)], [(&#39;bar&#39;, &#39;baz&#39;)]]</span>
<span class="sd">    &gt;&gt;&gt; split_header_words([&#39;text/html; charset=&quot;iso-8859-1&quot;&#39;])</span>
<span class="sd">    [[(&#39;text/html&#39;, None), (&#39;charset&#39;, &#39;iso-8859-1&#39;)]]</span>
<span class="sd">    &gt;&gt;&gt; split_header_words([r&#39;Basic realm=&quot;\&quot;foo\bar\&quot;&quot;&#39;])</span>
<span class="sd">    [[(&#39;Basic&#39;, None), (&#39;realm&#39;, &#39;&quot;foobar&quot;&#39;)]]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">header_values</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">header_values</span><span class="p">:</span>
        <span class="n">orig_text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">text</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">HEADER_TOKEN_RE</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">unmatched</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">HEADER_QUOTED_VALUE_RE</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">:</span>  <span class="c1"># quoted value</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="n">unmatched</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">HEADER_ESCAPE_RE</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">r&quot;\1&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">HEADER_VALUE_RE</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>  <span class="c1"># unquoted value</span>
                        <span class="n">text</span> <span class="o">=</span> <span class="n">unmatched</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># no value, a lone token</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">text</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">):</span>
                <span class="c1"># concatenated headers, as per RFC 2616 section 4.2</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">if</span> <span class="n">pairs</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pairs</span><span class="p">)</span>
                <span class="n">pairs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># skip junk</span>
                <span class="n">non_junk</span><span class="p">,</span> <span class="n">nr_junk_chars</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">subn</span><span class="p">(</span><span class="s2">&quot;^[=\s;]*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">nr_junk_chars</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span>
                    <span class="s2">&quot;split_header_words bug: &#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;</span><span class="si">%s</span><span class="s2">&#39;, </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="n">orig_text</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">pairs</span><span class="p">))</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">non_junk</span>
        <span class="k">if</span> <span class="n">pairs</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pairs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span></div>

<span class="n">HEADER_JOIN_ESCAPE_RE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;([</span><span class="se">\&quot;\\</span><span class="s2">])&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="join_header_words"><a class="viewcode-back" href="../generated/generated/cookielib.join_header_words.html#cookielib.join_header_words">[docs]</a><span class="k">def</span> <span class="nf">join_header_words</span><span class="p">(</span><span class="n">lists</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Do the inverse (almost) of the conversion done by split_header_words.</span>

<span class="sd">    Takes a list of lists of (key, value) pairs and produces a single header</span>
<span class="sd">    value.  Attribute values are quoted if needed.</span>

<span class="sd">    &gt;&gt;&gt; join_header_words([[(&quot;text/plain&quot;, None), (&quot;charset&quot;, &quot;iso-8859/1&quot;)]])</span>
<span class="sd">    &#39;text/plain; charset=&quot;iso-8859/1&quot;&#39;</span>
<span class="sd">    &gt;&gt;&gt; join_header_words([[(&quot;text/plain&quot;, None)], [(&quot;charset&quot;, &quot;iso-8859/1&quot;)]])</span>
<span class="sd">    &#39;text/plain, charset=&quot;iso-8859/1&quot;&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">pairs</span> <span class="ow">in</span> <span class="n">lists</span><span class="p">:</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">r&quot;^\w+$&quot;</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">HEADER_JOIN_ESCAPE_RE</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">r&quot;</span><span class="se">\\</span><span class="s2">\1&quot;</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>  <span class="c1"># escape &quot; and \</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="s1">&#39;&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">v</span>
                <span class="n">k</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="n">attr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attr</span><span class="p">:</span> <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">attr</span><span class="p">))</span>
    <span class="k">return</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span></div>

<span class="k">def</span> <span class="nf">_strip_quotes</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">text</span>

<div class="viewcode-block" id="parse_ns_headers"><a class="viewcode-back" href="../generated/generated/cookielib.parse_ns_headers.html#cookielib.parse_ns_headers">[docs]</a><span class="k">def</span> <span class="nf">parse_ns_headers</span><span class="p">(</span><span class="n">ns_headers</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Ad-hoc parser for Netscape protocol cookie-attributes.</span>

<span class="sd">    The old Netscape cookie format for Set-Cookie can for instance contain</span>
<span class="sd">    an unquoted &quot;,&quot; in the expires field, so we have to use this ad-hoc</span>
<span class="sd">    parser instead of split_header_words.</span>

<span class="sd">    XXX This may not make the best possible effort to parse all the crap</span>
<span class="sd">    that Netscape Cookie headers contain.  Ronald Tschalar&#39;s HTTPClient</span>
<span class="sd">    parser is probably better, so could do worse than following that if</span>
<span class="sd">    this ever gives any trouble.</span>

<span class="sd">    Currently, this is also used for parsing RFC 2109 cookies.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">known_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;expires&quot;</span><span class="p">,</span> <span class="s2">&quot;domain&quot;</span><span class="p">,</span> <span class="s2">&quot;path&quot;</span><span class="p">,</span> <span class="s2">&quot;secure&quot;</span><span class="p">,</span>
                   <span class="c1"># RFC 2109 attrs (may turn up in Netscape cookies, too)</span>
                   <span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="p">,</span> <span class="s2">&quot;max-age&quot;</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ns_header</span> <span class="ow">in</span> <span class="n">ns_headers</span><span class="p">:</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">version_set</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c1"># XXX: The following does not strictly adhere to RFCs in that empty</span>
        <span class="c1"># names and values are legal (the former will only appear once and will</span>
        <span class="c1"># be overwritten if multiple occurrences are present). This is</span>
        <span class="c1"># mostly to deal with backwards compatibility.</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ns_header</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)):</span>
            <span class="n">param</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="n">key</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ii</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>

            <span class="c1"># allow for a distinction between present and empty and missing</span>
            <span class="c1"># altogether</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">sep</span> <span class="k">else</span> <span class="bp">None</span>

            <span class="k">if</span> <span class="n">ii</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">lc</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">lc</span> <span class="ow">in</span> <span class="n">known_attrs</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">lc</span>

                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;version&quot;</span><span class="p">:</span>
                    <span class="c1"># This is an RFC 2109 cookie.</span>
                    <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="n">_strip_quotes</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                    <span class="n">version_set</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;expires&quot;</span><span class="p">:</span>
                    <span class="c1"># convert expires date to seconds since epoch</span>
                    <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="n">http2time</span><span class="p">(</span><span class="n">_strip_quotes</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>  <span class="c1"># None if invalid</span>
            <span class="n">pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">pairs</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">version_set</span><span class="p">:</span>
                <span class="n">pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">))</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pairs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span></div>


<span class="n">IPV4_RE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;\.\d+$&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="is_HDN"><a class="viewcode-back" href="../generated/generated/cookielib.is_HDN.html#cookielib.is_HDN">[docs]</a><span class="k">def</span> <span class="nf">is_HDN</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return True if text is a host domain name.&quot;&quot;&quot;</span>
    <span class="c1"># XXX</span>
    <span class="c1"># This may well be wrong.  Which RFC is HDN defined in, if any (for</span>
    <span class="c1">#  the purposes of RFC 2965)?</span>
    <span class="c1"># For the current implementation, what about IPv6?  Remember to look</span>
    <span class="c1">#  at other uses of IPV4_RE also, if change this.</span>
    <span class="k">if</span> <span class="n">IPV4_RE</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.&quot;</span> <span class="ow">or</span> <span class="n">text</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="domain_match"><a class="viewcode-back" href="../generated/generated/cookielib.domain_match.html#cookielib.domain_match">[docs]</a><span class="k">def</span> <span class="nf">domain_match</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return True if domain A domain-matches domain B, according to RFC 2965.</span>

<span class="sd">    A and B may be host domain names or IP addresses.</span>

<span class="sd">    RFC 2965, section 1:</span>

<span class="sd">    Host names can be specified either as an IP address or a HDN string.</span>
<span class="sd">    Sometimes we compare one host name with another.  (Such comparisons SHALL</span>
<span class="sd">    be case-insensitive.)  Host A&#39;s name domain-matches host B&#39;s if</span>

<span class="sd">         *  their host name strings string-compare equal; or</span>

<span class="sd">         * A is a HDN string and has the form NB, where N is a non-empty</span>
<span class="sd">            name string, B has the form .B&#39;, and B&#39; is a HDN string.  (So,</span>
<span class="sd">            x.y.com domain-matches .Y.com but not Y.com.)</span>

<span class="sd">    Note that domain-match is not a commutative operation: a.b.c.com</span>
<span class="sd">    domain-matches .c.com, but not the reverse.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Note that, if A or B are IP addresses, the only relevant part of the</span>
    <span class="c1"># definition of the domain-match algorithm is the direct string-compare.</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">A</span> <span class="o">==</span> <span class="n">B</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_HDN</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># A does not have form NB, or N is the empty string</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">B</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_HDN</span><span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="liberal_is_HDN"><a class="viewcode-back" href="../generated/generated/cookielib.liberal_is_HDN.html#cookielib.liberal_is_HDN">[docs]</a><span class="k">def</span> <span class="nf">liberal_is_HDN</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return True if text is a sort-of-like a host domain name.</span>

<span class="sd">    For accepting/blocking domains.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">IPV4_RE</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="user_domain_match"><a class="viewcode-back" href="../generated/generated/cookielib.user_domain_match.html#cookielib.user_domain_match">[docs]</a><span class="k">def</span> <span class="nf">user_domain_match</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;For blocking/accepting domains.</span>

<span class="sd">    A and B may be host domain names or IP addresses.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">liberal_is_HDN</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="ow">and</span> <span class="n">liberal_is_HDN</span><span class="p">(</span><span class="n">B</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">A</span> <span class="o">==</span> <span class="n">B</span><span class="p">:</span>
            <span class="c1"># equal IP addresses</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="n">initial_dot</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">initial_dot</span> <span class="ow">and</span> <span class="n">A</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">B</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">initial_dot</span> <span class="ow">and</span> <span class="n">A</span> <span class="o">==</span> <span class="n">B</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span></div>

<span class="n">cut_port_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;:\d+$&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="request_host"><a class="viewcode-back" href="../generated/generated/cookielib.request_host.html#cookielib.request_host">[docs]</a><span class="k">def</span> <span class="nf">request_host</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return request-host, as defined by RFC 2965.</span>

<span class="sd">    Variation from RFC: returned value is lowercased, for convenient</span>
<span class="sd">    comparison.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_full_url</span><span class="p">()</span>
    <span class="n">host</span> <span class="o">=</span> <span class="n">urlparse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">host</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">host</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="s2">&quot;Host&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># remove port, if present</span>
    <span class="n">host</span> <span class="o">=</span> <span class="n">cut_port_re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">host</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span></div>

<div class="viewcode-block" id="eff_request_host"><a class="viewcode-back" href="../generated/generated/cookielib.eff_request_host.html#cookielib.eff_request_host">[docs]</a><span class="k">def</span> <span class="nf">eff_request_host</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a tuple (request-host, effective request-host name).</span>

<span class="sd">    As defined by RFC 2965, except both are lowercased.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">erhn</span> <span class="o">=</span> <span class="n">req_host</span> <span class="o">=</span> <span class="n">request_host</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">req_host</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">IPV4_RE</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">req_host</span><span class="p">):</span>
        <span class="n">erhn</span> <span class="o">=</span> <span class="n">req_host</span> <span class="o">+</span> <span class="s2">&quot;.local&quot;</span>
    <span class="k">return</span> <span class="n">req_host</span><span class="p">,</span> <span class="n">erhn</span></div>

<div class="viewcode-block" id="request_path"><a class="viewcode-back" href="../generated/generated/cookielib.request_path.html#cookielib.request_path">[docs]</a><span class="k">def</span> <span class="nf">request_path</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Path component of request-URI, as defined by RFC 2965.&quot;&quot;&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_full_url</span><span class="p">()</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">urlparse</span><span class="o">.</span><span class="n">urlsplit</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">escape_path</span><span class="p">(</span><span class="n">parts</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">):</span>
        <span class="c1"># fix bad RFC 2396 absoluteURI</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">path</span>
    <span class="k">return</span> <span class="n">path</span></div>

<div class="viewcode-block" id="request_port"><a class="viewcode-back" href="../generated/generated/cookielib.request_port.html#cookielib.request_port">[docs]</a><span class="k">def</span> <span class="nf">request_port</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">host</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_host</span><span class="p">()</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">host</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">port</span> <span class="o">=</span> <span class="n">host</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;nonnumeric port: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">port</span> <span class="o">=</span> <span class="n">DEFAULT_HTTP_PORT</span>
    <span class="k">return</span> <span class="n">port</span></div>

<span class="c1"># Characters in addition to A-Z, a-z, 0-9, &#39;_&#39;, &#39;.&#39;, and &#39;-&#39; that don&#39;t</span>
<span class="c1"># need to be escaped to form a valid HTTP URL (RFCs 2396 and 1738).</span>
<span class="n">HTTP_PATH_SAFE</span> <span class="o">=</span> <span class="s2">&quot;%/;:@&amp;=+$,!~*&#39;()&quot;</span>
<span class="n">ESCAPED_CHAR_RE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;%([0-9a-fA-F][0-9a-fA-F])&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="uppercase_escaped_char"><a class="viewcode-back" href="../generated/generated/cookielib.uppercase_escaped_char.html#cookielib.uppercase_escaped_char">[docs]</a><span class="k">def</span> <span class="nf">uppercase_escaped_char</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%%%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span></div>
<div class="viewcode-block" id="escape_path"><a class="viewcode-back" href="../generated/generated/cookielib.escape_path.html#cookielib.escape_path">[docs]</a><span class="k">def</span> <span class="nf">escape_path</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Escape any invalid characters in HTTP URL, and uppercase all escapes.&quot;&quot;&quot;</span>
    <span class="c1"># There&#39;s no knowing what character encoding was used to create URLs</span>
    <span class="c1"># containing %-escapes, but since we have to pick one to escape invalid</span>
    <span class="c1"># path characters, we pick UTF-8, as recommended in the HTML 4.0</span>
    <span class="c1"># specification:</span>
    <span class="c1"># http://www.w3.org/TR/REC-html40/appendix/notes.html#h-B.2.1</span>
    <span class="c1"># And here, kind of: draft-fielding-uri-rfc2396bis-03</span>
    <span class="c1"># (And in draft IRI specification: draft-duerst-iri-05)</span>
    <span class="c1"># (And here, for new URI schemes: RFC 2718)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">HTTP_PATH_SAFE</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">ESCAPED_CHAR_RE</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">uppercase_escaped_char</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path</span></div>

<div class="viewcode-block" id="reach"><a class="viewcode-back" href="../generated/generated/cookielib.reach.html#cookielib.reach">[docs]</a><span class="k">def</span> <span class="nf">reach</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return reach of host h, as defined by RFC 2965, section 1.</span>

<span class="sd">    The reach R of a host name H is defined as follows:</span>

<span class="sd">       *  If</span>

<span class="sd">          -  H is the host domain name of a host; and,</span>

<span class="sd">          -  H has the form A.B; and</span>

<span class="sd">          -  A has no embedded (that is, interior) dots; and</span>

<span class="sd">          -  B has at least one embedded dot, or B is the string &quot;local&quot;.</span>
<span class="sd">             then the reach of H is .B.</span>

<span class="sd">       *  Otherwise, the reach of H is H.</span>

<span class="sd">    &gt;&gt;&gt; reach(&quot;www.acme.com&quot;)</span>
<span class="sd">    &#39;.acme.com&#39;</span>
<span class="sd">    &gt;&gt;&gt; reach(&quot;acme.com&quot;)</span>
<span class="sd">    &#39;acme.com&#39;</span>
<span class="sd">    &gt;&gt;&gt; reach(&quot;acme.local&quot;)</span>
<span class="sd">    &#39;.local&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1">#a = h[:i]  # this line is only here to show what a is</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_HDN</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">b</span> <span class="o">==</span> <span class="s2">&quot;local&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="n">b</span>
    <span class="k">return</span> <span class="n">h</span></div>

<div class="viewcode-block" id="is_third_party"><a class="viewcode-back" href="../generated/generated/cookielib.is_third_party.html#cookielib.is_third_party">[docs]</a><span class="k">def</span> <span class="nf">is_third_party</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    RFC 2965, section 3.3.6:</span>

<span class="sd">        An unverifiable transaction is to a third-party host if its request-</span>
<span class="sd">        host U does not domain-match the reach R of the request-host O in the</span>
<span class="sd">        origin transaction.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">req_host</span> <span class="o">=</span> <span class="n">request_host</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">domain_match</span><span class="p">(</span><span class="n">req_host</span><span class="p">,</span> <span class="n">reach</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">get_origin_req_host</span><span class="p">())):</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span></div>


<div class="viewcode-block" id="Cookie"><a class="viewcode-back" href="../generated/generated/cookielib.Cookie.html#cookielib.Cookie">[docs]</a><span class="k">class</span> <span class="nc">Cookie</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;HTTP Cookie.</span>

<span class="sd">    This class represents both Netscape and RFC 2965 cookies.</span>

<span class="sd">    This is deliberately a very simple class.  It just holds attributes.  It&#39;s</span>
<span class="sd">    possible to construct Cookie instances that don&#39;t comply with the cookie</span>
<span class="sd">    standards.  CookieJar.make_cookies is the factory function for Cookie</span>
<span class="sd">    objects -- it deals with cookie parsing, supplying defaults, and</span>
<span class="sd">    normalising to the representation used in this class.  CookiePolicy is</span>
<span class="sd">    responsible for checking them to see whether they should be accepted from</span>
<span class="sd">    and returned to the server.</span>

<span class="sd">    Note that the port may be present in the headers, but unspecified (&quot;Port&quot;</span>
<span class="sd">    rather than&quot;Port=80&quot;, for example); if this is the case, port is None.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Cookie.__init__"><a class="viewcode-back" href="../generated/generated/cookielib.Cookie.__init__.html#cookielib.Cookie.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span>
                 <span class="n">port</span><span class="p">,</span> <span class="n">port_specified</span><span class="p">,</span>
                 <span class="n">domain</span><span class="p">,</span> <span class="n">domain_specified</span><span class="p">,</span> <span class="n">domain_initial_dot</span><span class="p">,</span>
                 <span class="n">path</span><span class="p">,</span> <span class="n">path_specified</span><span class="p">,</span>
                 <span class="n">secure</span><span class="p">,</span>
                 <span class="n">expires</span><span class="p">,</span>
                 <span class="n">discard</span><span class="p">,</span>
                 <span class="n">comment</span><span class="p">,</span>
                 <span class="n">comment_url</span><span class="p">,</span>
                 <span class="n">rest</span><span class="p">,</span>
                 <span class="n">rfc2109</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="p">):</span>

        <span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">version</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">expires</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">expires</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">expires</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">port</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">port_specified</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;if port is None, port_specified must be false&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port_specified</span> <span class="o">=</span> <span class="n">port_specified</span>
        <span class="c1"># normalise case, as per RFC 2965 section 3.3.3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domain_specified</span> <span class="o">=</span> <span class="n">domain_specified</span>
        <span class="c1"># Sigh.  We need to know whether the domain given in the</span>
        <span class="c1"># cookie-attribute had an initial dot, in order to follow RFC 2965</span>
        <span class="c1"># (as clarified in draft errata).  Needed for the returned $Domain</span>
        <span class="c1"># value.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domain_initial_dot</span> <span class="o">=</span> <span class="n">domain_initial_dot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path_specified</span> <span class="o">=</span> <span class="n">path_specified</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">secure</span> <span class="o">=</span> <span class="n">secure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expires</span> <span class="o">=</span> <span class="n">expires</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">discard</span> <span class="o">=</span> <span class="n">discard</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comment_url</span> <span class="o">=</span> <span class="n">comment_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rfc2109</span> <span class="o">=</span> <span class="n">rfc2109</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_rest</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">rest</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cookie.has_nonstandard_attr"><a class="viewcode-back" href="../generated/generated/cookielib.Cookie.has_nonstandard_attr.html#cookielib.Cookie.has_nonstandard_attr">[docs]</a>    <span class="k">def</span> <span class="nf">has_nonstandard_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rest</span></div>
<div class="viewcode-block" id="Cookie.get_nonstandard_attr"><a class="viewcode-back" href="../generated/generated/cookielib.Cookie.get_nonstandard_attr.html#cookielib.Cookie.get_nonstandard_attr">[docs]</a>    <span class="k">def</span> <span class="nf">get_nonstandard_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rest</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span></div>
<div class="viewcode-block" id="Cookie.set_nonstandard_attr"><a class="viewcode-back" href="../generated/generated/cookielib.Cookie.set_nonstandard_attr.html#cookielib.Cookie.set_nonstandard_attr">[docs]</a>    <span class="k">def</span> <span class="nf">set_nonstandard_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rest</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Cookie.is_expired"><a class="viewcode-back" href="../generated/generated/cookielib.Cookie.is_expired.html#cookielib.Cookie.is_expired">[docs]</a>    <span class="k">def</span> <span class="nf">is_expired</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">now</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">now</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expires</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expires</span> <span class="o">&lt;=</span> <span class="n">now</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span></div>

<div class="viewcode-block" id="Cookie.__str__"><a class="viewcode-back" href="../generated/generated/cookielib.Cookie.__str__.html#cookielib.Cookie.__str__">[docs]</a>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">p</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">p</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span>
        <span class="n">limit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">namevalue</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">namevalue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;Cookie </span><span class="si">%s</span><span class="s2"> for </span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">namevalue</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cookie.__repr__"><a class="viewcode-back" href="../generated/generated/cookielib.Cookie.__repr__.html#cookielib.Cookie.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;port&quot;</span><span class="p">,</span> <span class="s2">&quot;port_specified&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;domain&quot;</span><span class="p">,</span> <span class="s2">&quot;domain_specified&quot;</span><span class="p">,</span> <span class="s2">&quot;domain_initial_dot&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;path&quot;</span><span class="p">,</span> <span class="s2">&quot;path_specified&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;secure&quot;</span><span class="p">,</span> <span class="s2">&quot;expires&quot;</span><span class="p">,</span> <span class="s2">&quot;discard&quot;</span><span class="p">,</span> <span class="s2">&quot;comment&quot;</span><span class="p">,</span> <span class="s2">&quot;comment_url&quot;</span><span class="p">,</span>
                     <span class="p">):</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">attr</span><span class="p">)))</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;rest=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rest</span><span class="p">))</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;rfc2109=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc2109</span><span class="p">))</span>
        <span class="k">return</span> <span class="s2">&quot;Cookie(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="CookiePolicy"><a class="viewcode-back" href="../generated/generated/cookielib.CookiePolicy.html#cookielib.CookiePolicy">[docs]</a><span class="k">class</span> <span class="nc">CookiePolicy</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Defines which cookies get accepted from and returned to server.</span>

<span class="sd">    May also modify cookies, though this is probably a bad idea.</span>

<span class="sd">    The subclass DefaultCookiePolicy defines the standard rules for Netscape</span>
<span class="sd">    and RFC 2965 cookies -- override that if you want a customised policy.</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="CookiePolicy.set_ok"><a class="viewcode-back" href="../generated/generated/cookielib.CookiePolicy.set_ok.html#cookielib.CookiePolicy.set_ok">[docs]</a>    <span class="k">def</span> <span class="nf">set_ok</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cookie</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return true if (and only if) cookie should be accepted from server.</span>

<span class="sd">        Currently, pre-expired cookies never get this far -- the CookieJar</span>
<span class="sd">        class deletes such cookies itself.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="CookiePolicy.return_ok"><a class="viewcode-back" href="../generated/generated/cookielib.CookiePolicy.return_ok.html#cookielib.CookiePolicy.return_ok">[docs]</a>    <span class="k">def</span> <span class="nf">return_ok</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cookie</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return true if (and only if) cookie should be returned to server.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="CookiePolicy.domain_return_ok"><a class="viewcode-back" href="../generated/generated/cookielib.CookiePolicy.domain_return_ok.html#cookielib.CookiePolicy.domain_return_ok">[docs]</a>    <span class="k">def</span> <span class="nf">domain_return_ok</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return false if cookies should not be returned, given cookie domain.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="CookiePolicy.path_return_ok"><a class="viewcode-back" href="../generated/generated/cookielib.CookiePolicy.path_return_ok.html#cookielib.CookiePolicy.path_return_ok">[docs]</a>    <span class="k">def</span> <span class="nf">path_return_ok</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return false if cookies should not be returned, given cookie path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">True</span></div></div>


<div class="viewcode-block" id="DefaultCookiePolicy"><a class="viewcode-back" href="../generated/generated/cookielib.DefaultCookiePolicy.html#cookielib.DefaultCookiePolicy">[docs]</a><span class="k">class</span> <span class="nc">DefaultCookiePolicy</span><span class="p">(</span><span class="n">CookiePolicy</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Implements the standard rules for accepting and returning cookies.&quot;&quot;&quot;</span>

    <span class="n">DomainStrictNoDots</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">DomainStrictNonDomain</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">DomainRFC2965Match</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="n">DomainLiberal</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">DomainStrict</span> <span class="o">=</span> <span class="n">DomainStrictNoDots</span><span class="o">|</span><span class="n">DomainStrictNonDomain</span>

<div class="viewcode-block" id="DefaultCookiePolicy.__init__"><a class="viewcode-back" href="../generated/generated/cookielib.DefaultCookiePolicy.__init__.html#cookielib.DefaultCookiePolicy.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">blocked_domains</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">allowed_domains</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">netscape</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">rfc2965</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">rfc2109_as_netscape</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">hide_cookie2</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">strict_domain</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">strict_rfc2965_unverifiable</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">strict_ns_unverifiable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">strict_ns_domain</span><span class="o">=</span><span class="n">DomainLiberal</span><span class="p">,</span>
                 <span class="n">strict_ns_set_initial_dollar</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">strict_ns_set_path</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor arguments should be passed as keyword arguments only.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netscape</span> <span class="o">=</span> <span class="n">netscape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rfc2965</span> <span class="o">=</span> <span class="n">rfc2965</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rfc2109_as_netscape</span> <span class="o">=</span> <span class="n">rfc2109_as_netscape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hide_cookie2</span> <span class="o">=</span> <span class="n">hide_cookie2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strict_domain</span> <span class="o">=</span> <span class="n">strict_domain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strict_rfc2965_unverifiable</span> <span class="o">=</span> <span class="n">strict_rfc2965_unverifiable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strict_ns_unverifiable</span> <span class="o">=</span> <span class="n">strict_ns_unverifiable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strict_ns_domain</span> <span class="o">=</span> <span class="n">strict_ns_domain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strict_ns_set_initial_dollar</span> <span class="o">=</span> <span class="n">strict_ns_set_initial_dollar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strict_ns_set_path</span> <span class="o">=</span> <span class="n">strict_ns_set_path</span>

        <span class="k">if</span> <span class="n">blocked_domains</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_blocked_domains</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">blocked_domains</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_blocked_domains</span> <span class="o">=</span> <span class="p">()</span>

        <span class="k">if</span> <span class="n">allowed_domains</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">allowed_domains</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">allowed_domains</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_allowed_domains</span> <span class="o">=</span> <span class="n">allowed_domains</span></div>

<div class="viewcode-block" id="DefaultCookiePolicy.blocked_domains"><a class="viewcode-back" href="../generated/generated/cookielib.DefaultCookiePolicy.blocked_domains.html#cookielib.DefaultCookiePolicy.blocked_domains">[docs]</a>    <span class="k">def</span> <span class="nf">blocked_domains</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the sequence of blocked domains (as a tuple).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blocked_domains</span></div>
<div class="viewcode-block" id="DefaultCookiePolicy.set_blocked_domains"><a class="viewcode-back" href="../generated/generated/cookielib.DefaultCookiePolicy.set_blocked_domains.html#cookielib.DefaultCookiePolicy.set_blocked_domains">[docs]</a>    <span class="k">def</span> <span class="nf">set_blocked_domains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">blocked_domains</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the sequence of blocked domains.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_blocked_domains</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">blocked_domains</span><span class="p">)</span></div>

<div class="viewcode-block" id="DefaultCookiePolicy.is_blocked"><a class="viewcode-back" href="../generated/generated/cookielib.DefaultCookiePolicy.is_blocked.html#cookielib.DefaultCookiePolicy.is_blocked">[docs]</a>    <span class="k">def</span> <span class="nf">is_blocked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">blocked_domain</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blocked_domains</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">user_domain_match</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">blocked_domain</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span></div>

<div class="viewcode-block" id="DefaultCookiePolicy.allowed_domains"><a class="viewcode-back" href="../generated/generated/cookielib.DefaultCookiePolicy.allowed_domains.html#cookielib.DefaultCookiePolicy.allowed_domains">[docs]</a>    <span class="k">def</span> <span class="nf">allowed_domains</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return None, or the sequence of allowed domains (as a tuple).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allowed_domains</span></div>
<div class="viewcode-block" id="DefaultCookiePolicy.set_allowed_domains"><a class="viewcode-back" href="../generated/generated/cookielib.DefaultCookiePolicy.set_allowed_domains.html#cookielib.DefaultCookiePolicy.set_allowed_domains">[docs]</a>    <span class="k">def</span> <span class="nf">set_allowed_domains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allowed_domains</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the sequence of allowed domains, or None.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">allowed_domains</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">allowed_domains</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">allowed_domains</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_allowed_domains</span> <span class="o">=</span> <span class="n">allowed_domains</span></div>

<div class="viewcode-block" id="DefaultCookiePolicy.is_not_allowed"><a class="viewcode-back" href="../generated/generated/cookielib.DefaultCookiePolicy.is_not_allowed.html#cookielib.DefaultCookiePolicy.is_not_allowed">[docs]</a>    <span class="k">def</span> <span class="nf">is_not_allowed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allowed_domains</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">allowed_domain</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allowed_domains</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">user_domain_match</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">allowed_domain</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="DefaultCookiePolicy.set_ok"><a class="viewcode-back" href="../generated/generated/cookielib.DefaultCookiePolicy.set_ok.html#cookielib.DefaultCookiePolicy.set_ok">[docs]</a>    <span class="k">def</span> <span class="nf">set_ok</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cookie</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If you override .set_ok(), be sure to call this method.  If it returns</span>
<span class="sd">        false, so should your subclass (assuming your subclass wants to be more</span>
<span class="sd">        strict about which cookies to accept).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot; - checking cookie </span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">cookie</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cookie</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">cookie</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="s2">&quot;verifiability&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;path&quot;</span><span class="p">,</span> <span class="s2">&quot;domain&quot;</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="p">:</span>
            <span class="n">fn_name</span> <span class="o">=</span> <span class="s2">&quot;set_ok_&quot;</span><span class="o">+</span><span class="n">n</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">fn</span><span class="p">(</span><span class="n">cookie</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="DefaultCookiePolicy.set_ok_version"><a class="viewcode-back" href="../generated/generated/cookielib.DefaultCookiePolicy.set_ok_version.html#cookielib.DefaultCookiePolicy.set_ok_version">[docs]</a>    <span class="k">def</span> <span class="nf">set_ok_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cookie</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cookie</span><span class="o">.</span><span class="n">version</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># Version is always set to 0 by parse_ns_headers if it&#39;s a Netscape</span>
            <span class="c1"># cookie, so this must be an invalid RFC 2965 cookie.</span>
            <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   Set-Cookie2 without version attribute (</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
                   <span class="n">cookie</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cookie</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">cookie</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfc2965</span><span class="p">:</span>
            <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   RFC 2965 cookies are switched off&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="n">cookie</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">netscape</span><span class="p">:</span>
            <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   Netscape cookies are switched off&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="DefaultCookiePolicy.set_ok_verifiability"><a class="viewcode-back" href="../generated/generated/cookielib.DefaultCookiePolicy.set_ok_verifiability.html#cookielib.DefaultCookiePolicy.set_ok_verifiability">[docs]</a>    <span class="k">def</span> <span class="nf">set_ok_verifiability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cookie</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">is_unverifiable</span><span class="p">()</span> <span class="ow">and</span> <span class="n">is_third_party</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">cookie</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">strict_rfc2965_unverifiable</span><span class="p">:</span>
                <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   third-party RFC 2965 cookie during &quot;</span>
                             <span class="s2">&quot;unverifiable transaction&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">elif</span> <span class="n">cookie</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">strict_ns_unverifiable</span><span class="p">:</span>
                <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   third-party Netscape cookie during &quot;</span>
                             <span class="s2">&quot;unverifiable transaction&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="DefaultCookiePolicy.set_ok_name"><a class="viewcode-back" href="../generated/generated/cookielib.DefaultCookiePolicy.set_ok_name.html#cookielib.DefaultCookiePolicy.set_ok_name">[docs]</a>    <span class="k">def</span> <span class="nf">set_ok_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cookie</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="c1"># Try and stop servers setting V0 cookies designed to hack other</span>
        <span class="c1"># servers that know both V0 and V1 protocols.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">strict_ns_set_initial_dollar</span> <span class="ow">and</span>
            <span class="n">cookie</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;$&quot;</span><span class="p">)):</span>
            <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   illegal name (starts with &#39;$&#39;): &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">cookie</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="DefaultCookiePolicy.set_ok_path"><a class="viewcode-back" href="../generated/generated/cookielib.DefaultCookiePolicy.set_ok_path.html#cookielib.DefaultCookiePolicy.set_ok_path">[docs]</a>    <span class="k">def</span> <span class="nf">set_ok_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cookie</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cookie</span><span class="o">.</span><span class="n">path_specified</span><span class="p">:</span>
            <span class="n">req_path</span> <span class="o">=</span> <span class="n">request_path</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">cookie</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span>
                 <span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">strict_ns_set_path</span><span class="p">))</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="n">req_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">path</span><span class="p">)):</span>
                <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   path attribute </span><span class="si">%s</span><span class="s2"> is not a prefix of request &quot;</span>
                       <span class="s2">&quot;path </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">cookie</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">req_path</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="DefaultCookiePolicy.set_ok_domain"><a class="viewcode-back" href="../generated/generated/cookielib.DefaultCookiePolicy.set_ok_domain.html#cookielib.DefaultCookiePolicy.set_ok_domain">[docs]</a>    <span class="k">def</span> <span class="nf">set_ok_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cookie</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_blocked</span><span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">domain</span><span class="p">):</span>
            <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   domain </span><span class="si">%s</span><span class="s2"> is in user block-list&quot;</span><span class="p">,</span> <span class="n">cookie</span><span class="o">.</span><span class="n">domain</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_not_allowed</span><span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">domain</span><span class="p">):</span>
            <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   domain </span><span class="si">%s</span><span class="s2"> is not in user allow-list&quot;</span><span class="p">,</span> <span class="n">cookie</span><span class="o">.</span><span class="n">domain</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">cookie</span><span class="o">.</span><span class="n">domain_specified</span><span class="p">:</span>
            <span class="n">req_host</span><span class="p">,</span> <span class="n">erhn</span> <span class="o">=</span> <span class="n">eff_request_host</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="n">cookie</span><span class="o">.</span><span class="n">domain</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">strict_domain</span> <span class="ow">and</span> <span class="p">(</span><span class="n">domain</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">):</span>
                <span class="c1"># XXX This should probably be compared with the Konqueror</span>
                <span class="c1"># (kcookiejar.cpp) and Mozilla implementations, but it&#39;s a</span>
                <span class="c1"># losing battle.</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># domain like .foo.bar</span>
                    <span class="n">tld</span> <span class="o">=</span> <span class="n">domain</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="n">sld</span> <span class="o">=</span> <span class="n">domain</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">sld</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;co&quot;</span><span class="p">,</span> <span class="s2">&quot;ac&quot;</span><span class="p">,</span> <span class="s2">&quot;com&quot;</span><span class="p">,</span> <span class="s2">&quot;edu&quot;</span><span class="p">,</span> <span class="s2">&quot;org&quot;</span><span class="p">,</span> <span class="s2">&quot;net&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;gov&quot;</span><span class="p">,</span> <span class="s2">&quot;mil&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="s2">&quot;aero&quot;</span><span class="p">,</span> <span class="s2">&quot;biz&quot;</span><span class="p">,</span> <span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="s2">&quot;coop&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="s2">&quot;jobs&quot;</span><span class="p">,</span> <span class="s2">&quot;mobi&quot;</span><span class="p">,</span> <span class="s2">&quot;museum&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;pro&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;travel&quot;</span><span class="p">,</span> <span class="s2">&quot;eu&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">tld</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="c1"># domain like .co.uk</span>
                        <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   country-code second level domain </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">domain</span><span class="p">)</span>
                        <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="n">domain</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
                <span class="n">undotted_domain</span> <span class="o">=</span> <span class="n">domain</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">undotted_domain</span> <span class="o">=</span> <span class="n">domain</span>
            <span class="n">embedded_dots</span> <span class="o">=</span> <span class="p">(</span><span class="n">undotted_domain</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">embedded_dots</span> <span class="ow">and</span> <span class="n">domain</span> <span class="o">!=</span> <span class="s2">&quot;.local&quot;</span><span class="p">:</span>
                <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   non-local domain </span><span class="si">%s</span><span class="s2"> contains no embedded dot&quot;</span><span class="p">,</span>
                       <span class="n">domain</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="n">cookie</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">erhn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span> <span class="ow">and</span>
                    <span class="p">(</span><span class="ow">not</span> <span class="n">erhn</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="ow">and</span>
                     <span class="ow">not</span> <span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="n">erhn</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">domain</span><span class="p">))):</span>
                    <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   effective request-host </span><span class="si">%s</span><span class="s2"> (even with added &quot;</span>
                           <span class="s2">&quot;initial dot) does not end with </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                           <span class="n">erhn</span><span class="p">,</span> <span class="n">domain</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strict_ns_domain</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DomainRFC2965Match</span><span class="p">)):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">domain_match</span><span class="p">(</span><span class="n">erhn</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span>
                    <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   effective request-host </span><span class="si">%s</span><span class="s2"> does not domain-match &quot;</span>
                           <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">erhn</span><span class="p">,</span> <span class="n">domain</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strict_ns_domain</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DomainStrictNoDots</span><span class="p">)):</span>
                <span class="n">host_prefix</span> <span class="o">=</span> <span class="n">req_host</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">domain</span><span class="p">)]</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">host_prefix</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span>
                    <span class="ow">not</span> <span class="n">IPV4_RE</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">req_host</span><span class="p">)):</span>
                    <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   host prefix </span><span class="si">%s</span><span class="s2"> for domain </span><span class="si">%s</span><span class="s2"> contains a dot&quot;</span><span class="p">,</span>
                           <span class="n">host_prefix</span><span class="p">,</span> <span class="n">domain</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="DefaultCookiePolicy.set_ok_port"><a class="viewcode-back" href="../generated/generated/cookielib.DefaultCookiePolicy.set_ok_port.html#cookielib.DefaultCookiePolicy.set_ok_port">[docs]</a>    <span class="k">def</span> <span class="nf">set_ok_port</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cookie</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cookie</span><span class="o">.</span><span class="n">port_specified</span><span class="p">:</span>
            <span class="n">req_port</span> <span class="o">=</span> <span class="n">request_port</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">req_port</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">req_port</span> <span class="o">=</span> <span class="s2">&quot;80&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">req_port</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">req_port</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">cookie</span><span class="o">.</span><span class="n">port</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   bad port </span><span class="si">%s</span><span class="s2"> (not numeric)&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">False</span>
                <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">req_port</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   request port (</span><span class="si">%s</span><span class="s2">) not found in </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                       <span class="n">req_port</span><span class="p">,</span> <span class="n">cookie</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="DefaultCookiePolicy.return_ok"><a class="viewcode-back" href="../generated/generated/cookielib.DefaultCookiePolicy.return_ok.html#cookielib.DefaultCookiePolicy.return_ok">[docs]</a>    <span class="k">def</span> <span class="nf">return_ok</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cookie</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If you override .return_ok(), be sure to call this method.  If it</span>
<span class="sd">        returns false, so should your subclass (assuming your subclass wants to</span>
<span class="sd">        be more strict about which cookies to return).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Path has already been checked by .path_return_ok(), and domain</span>
        <span class="c1"># blocking done by .domain_return_ok().</span>
        <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot; - checking cookie </span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">cookie</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cookie</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="s2">&quot;verifiability&quot;</span><span class="p">,</span> <span class="s2">&quot;secure&quot;</span><span class="p">,</span> <span class="s2">&quot;expires&quot;</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="p">,</span> <span class="s2">&quot;domain&quot;</span><span class="p">:</span>
            <span class="n">fn_name</span> <span class="o">=</span> <span class="s2">&quot;return_ok_&quot;</span><span class="o">+</span><span class="n">n</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">fn</span><span class="p">(</span><span class="n">cookie</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="DefaultCookiePolicy.return_ok_version"><a class="viewcode-back" href="../generated/generated/cookielib.DefaultCookiePolicy.return_ok_version.html#cookielib.DefaultCookiePolicy.return_ok_version">[docs]</a>    <span class="k">def</span> <span class="nf">return_ok_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cookie</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cookie</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfc2965</span><span class="p">:</span>
            <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   RFC 2965 cookies are switched off&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="n">cookie</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">netscape</span><span class="p">:</span>
            <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   Netscape cookies are switched off&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="DefaultCookiePolicy.return_ok_verifiability"><a class="viewcode-back" href="../generated/generated/cookielib.DefaultCookiePolicy.return_ok_verifiability.html#cookielib.DefaultCookiePolicy.return_ok_verifiability">[docs]</a>    <span class="k">def</span> <span class="nf">return_ok_verifiability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cookie</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">is_unverifiable</span><span class="p">()</span> <span class="ow">and</span> <span class="n">is_third_party</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">cookie</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">strict_rfc2965_unverifiable</span><span class="p">:</span>
                <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   third-party RFC 2965 cookie during unverifiable &quot;</span>
                       <span class="s2">&quot;transaction&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">elif</span> <span class="n">cookie</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">strict_ns_unverifiable</span><span class="p">:</span>
                <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   third-party Netscape cookie during unverifiable &quot;</span>
                       <span class="s2">&quot;transaction&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="DefaultCookiePolicy.return_ok_secure"><a class="viewcode-back" href="../generated/generated/cookielib.DefaultCookiePolicy.return_ok_secure.html#cookielib.DefaultCookiePolicy.return_ok_secure">[docs]</a>    <span class="k">def</span> <span class="nf">return_ok_secure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cookie</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cookie</span><span class="o">.</span><span class="n">secure</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">get_type</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;https&quot;</span><span class="p">:</span>
            <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   secure cookie with non-secure request&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="DefaultCookiePolicy.return_ok_expires"><a class="viewcode-back" href="../generated/generated/cookielib.DefaultCookiePolicy.return_ok_expires.html#cookielib.DefaultCookiePolicy.return_ok_expires">[docs]</a>    <span class="k">def</span> <span class="nf">return_ok_expires</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cookie</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cookie</span><span class="o">.</span><span class="n">is_expired</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_now</span><span class="p">):</span>
            <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   cookie expired&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="DefaultCookiePolicy.return_ok_port"><a class="viewcode-back" href="../generated/generated/cookielib.DefaultCookiePolicy.return_ok_port.html#cookielib.DefaultCookiePolicy.return_ok_port">[docs]</a>    <span class="k">def</span> <span class="nf">return_ok_port</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cookie</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cookie</span><span class="o">.</span><span class="n">port</span><span class="p">:</span>
            <span class="n">req_port</span> <span class="o">=</span> <span class="n">request_port</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">req_port</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">req_port</span> <span class="o">=</span> <span class="s2">&quot;80&quot;</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">cookie</span><span class="o">.</span><span class="n">port</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">req_port</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   request port </span><span class="si">%s</span><span class="s2"> does not match cookie port </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                       <span class="n">req_port</span><span class="p">,</span> <span class="n">cookie</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="DefaultCookiePolicy.return_ok_domain"><a class="viewcode-back" href="../generated/generated/cookielib.DefaultCookiePolicy.return_ok_domain.html#cookielib.DefaultCookiePolicy.return_ok_domain">[docs]</a>    <span class="k">def</span> <span class="nf">return_ok_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cookie</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">req_host</span><span class="p">,</span> <span class="n">erhn</span> <span class="o">=</span> <span class="n">eff_request_host</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="n">cookie</span><span class="o">.</span><span class="n">domain</span>

        <span class="c1"># strict check of non-domain cookies: Mozilla does this, MSIE5 doesn&#39;t</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strict_ns_domain</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DomainStrictNonDomain</span><span class="p">)</span> <span class="ow">and</span>
            <span class="ow">not</span> <span class="n">cookie</span><span class="o">.</span><span class="n">domain_specified</span> <span class="ow">and</span> <span class="n">domain</span> <span class="o">!=</span> <span class="n">erhn</span><span class="p">):</span>
            <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   cookie with unspecified domain does not string-compare &quot;</span>
                   <span class="s2">&quot;equal to request domain&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="n">cookie</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">domain_match</span><span class="p">(</span><span class="n">erhn</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span>
            <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   effective request-host name </span><span class="si">%s</span><span class="s2"> does not domain-match &quot;</span>
                   <span class="s2">&quot;RFC 2965 cookie domain </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">erhn</span><span class="p">,</span> <span class="n">domain</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">cookie</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="n">erhn</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">domain</span><span class="p">):</span>
            <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   request-host </span><span class="si">%s</span><span class="s2"> does not match Netscape cookie domain &quot;</span>
                   <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">req_host</span><span class="p">,</span> <span class="n">domain</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="DefaultCookiePolicy.domain_return_ok"><a class="viewcode-back" href="../generated/generated/cookielib.DefaultCookiePolicy.domain_return_ok.html#cookielib.DefaultCookiePolicy.domain_return_ok">[docs]</a>    <span class="k">def</span> <span class="nf">domain_return_ok</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="c1"># Liberal check of.  This is here as an optimization to avoid</span>
        <span class="c1"># having to load lots of MSIE cookie files unless necessary.</span>
        <span class="n">req_host</span><span class="p">,</span> <span class="n">erhn</span> <span class="o">=</span> <span class="n">eff_request_host</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">req_host</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
            <span class="n">req_host</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="n">req_host</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">erhn</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
            <span class="n">erhn</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="n">erhn</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">req_host</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span> <span class="ow">or</span> <span class="n">erhn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">domain</span><span class="p">)):</span>
            <span class="c1">#_debug(&quot;   request domain %s does not match cookie domain %s&quot;,</span>
            <span class="c1">#       req_host, domain)</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_blocked</span><span class="p">(</span><span class="n">domain</span><span class="p">):</span>
            <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   domain </span><span class="si">%s</span><span class="s2"> is in user block-list&quot;</span><span class="p">,</span> <span class="n">domain</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_not_allowed</span><span class="p">(</span><span class="n">domain</span><span class="p">):</span>
            <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   domain </span><span class="si">%s</span><span class="s2"> is not in user allow-list&quot;</span><span class="p">,</span> <span class="n">domain</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="DefaultCookiePolicy.path_return_ok"><a class="viewcode-back" href="../generated/generated/cookielib.DefaultCookiePolicy.path_return_ok.html#cookielib.DefaultCookiePolicy.path_return_ok">[docs]</a>    <span class="k">def</span> <span class="nf">path_return_ok</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;- checking cookie path=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="n">req_path</span> <span class="o">=</span> <span class="n">request_path</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">req_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;  </span><span class="si">%s</span><span class="s2"> does not path-match </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">req_path</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span></div></div>


<div class="viewcode-block" id="vals_sorted_by_key"><a class="viewcode-back" href="../generated/generated/cookielib.vals_sorted_by_key.html#cookielib.vals_sorted_by_key">[docs]</a><span class="k">def</span> <span class="nf">vals_sorted_by_key</span><span class="p">(</span><span class="n">adict</span><span class="p">):</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="n">adict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="n">keys</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="n">adict</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span></div>

<div class="viewcode-block" id="deepvalues"><a class="viewcode-back" href="../generated/generated/cookielib.deepvalues.html#cookielib.deepvalues">[docs]</a><span class="k">def</span> <span class="nf">deepvalues</span><span class="p">(</span><span class="n">mapping</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Iterates over nested mapping, depth-first, in sorted order by key.&quot;&quot;&quot;</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">vals_sorted_by_key</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">items</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mapping</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">for</span> <span class="n">subobj</span> <span class="ow">in</span> <span class="n">deepvalues</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">subobj</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mapping</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">obj</span></div>


<span class="c1"># Used as second parameter to dict.get() method, to distinguish absent</span>
<span class="c1"># dict key from one with a None value.</span>
<div class="viewcode-block" id="Absent"><a class="viewcode-back" href="../generated/generated/cookielib.Absent.html#cookielib.Absent">[docs]</a><span class="k">class</span> <span class="nc">Absent</span><span class="p">:</span> <span class="k">pass</span></div>

<div class="viewcode-block" id="CookieJar"><a class="viewcode-back" href="../generated/generated/cookielib.CookieJar.html#cookielib.CookieJar">[docs]</a><span class="k">class</span> <span class="nc">CookieJar</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Collection of HTTP cookies.</span>

<span class="sd">    You may not need to know about this class: try</span>
<span class="sd">    urllib2.build_opener(HTTPCookieProcessor).open(url).</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">non_word_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;\W&quot;</span><span class="p">)</span>
    <span class="n">quote_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;([</span><span class="se">\&quot;\\</span><span class="s2">])&quot;</span><span class="p">)</span>
    <span class="n">strict_domain_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;\.?[^.]*&quot;</span><span class="p">)</span>
    <span class="n">domain_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;[^.]*&quot;</span><span class="p">)</span>
    <span class="n">dots_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;^\.+&quot;</span><span class="p">)</span>

    <span class="n">magic_re</span> <span class="o">=</span> <span class="s2">r&quot;^\#LWP-Cookies-(\d+\.\d+)&quot;</span>

<div class="viewcode-block" id="CookieJar.__init__"><a class="viewcode-back" href="../generated/generated/cookielib.CookieJar.__init__.html#cookielib.CookieJar.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">policy</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">policy</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">policy</span> <span class="o">=</span> <span class="n">DefaultCookiePolicy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_policy</span> <span class="o">=</span> <span class="n">policy</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_cookies_lock</span> <span class="o">=</span> <span class="n">_threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="CookieJar.set_policy"><a class="viewcode-back" href="../generated/generated/cookielib.CookieJar.set_policy.html#cookielib.CookieJar.set_policy">[docs]</a>    <span class="k">def</span> <span class="nf">set_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">policy</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_policy</span> <span class="o">=</span> <span class="n">policy</span></div>

<div class="viewcode-block" id="CookieJar._cookies_for_domain"><a class="viewcode-back" href="../generated/generated/cookielib.CookieJar._cookies_for_domain.html#cookielib.CookieJar._cookies_for_domain">[docs]</a>    <span class="k">def</span> <span class="nf">_cookies_for_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">cookies</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_policy</span><span class="o">.</span><span class="n">domain_return_ok</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;Checking </span><span class="si">%s</span><span class="s2"> for cookies to return&quot;</span><span class="p">,</span> <span class="n">domain</span><span class="p">)</span>
        <span class="n">cookies_by_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">cookies_by_path</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_policy</span><span class="o">.</span><span class="n">path_return_ok</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">cookies_by_name</span> <span class="o">=</span> <span class="n">cookies_by_path</span><span class="p">[</span><span class="n">path</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">cookie</span> <span class="ow">in</span> <span class="n">cookies_by_name</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_policy</span><span class="o">.</span><span class="n">return_ok</span><span class="p">(</span><span class="n">cookie</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
                    <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   not returning cookie&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   it&#39;s a match&quot;</span><span class="p">)</span>
                <span class="n">cookies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cookie</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cookies</span></div>

<div class="viewcode-block" id="CookieJar._cookies_for_request"><a class="viewcode-back" href="../generated/generated/cookielib.CookieJar._cookies_for_request.html#cookielib.CookieJar._cookies_for_request">[docs]</a>    <span class="k">def</span> <span class="nf">_cookies_for_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of cookies to be returned to server.&quot;&quot;&quot;</span>
        <span class="n">cookies</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">cookies</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cookies_for_domain</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">request</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">cookies</span></div>

<div class="viewcode-block" id="CookieJar._cookie_attrs"><a class="viewcode-back" href="../generated/generated/cookielib.CookieJar._cookie_attrs.html#cookielib.CookieJar._cookie_attrs">[docs]</a>    <span class="k">def</span> <span class="nf">_cookie_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cookies</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of cookie-attributes to be returned to server.</span>

<span class="sd">        like [&#39;foo=&quot;bar&quot;; $Path=&quot;/&quot;&#39;, ...]</span>

<span class="sd">        The $Version attribute is also added when appropriate (currently only</span>
<span class="sd">        once per request).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># add cookies in order of most specific (ie. longest) path first</span>
        <span class="n">cookies</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">arg</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">path</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">version_set</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="n">attrs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cookie</span> <span class="ow">in</span> <span class="n">cookies</span><span class="p">:</span>
            <span class="c1"># set version of Cookie header</span>
            <span class="c1"># XXX</span>
            <span class="c1"># What should it be if multiple matching Set-Cookie headers have</span>
            <span class="c1">#  different versions themselves?</span>
            <span class="c1"># Answer: there is no answer; was supposed to be settled by</span>
            <span class="c1">#  RFC 2965 errata, but that may never appear...</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">cookie</span><span class="o">.</span><span class="n">version</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">version_set</span><span class="p">:</span>
                <span class="n">version_set</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">if</span> <span class="n">version</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">attrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;$Version=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">version</span><span class="p">)</span>

            <span class="c1"># quote cookie value if necessary</span>
            <span class="c1"># (not for Netscape protocol, which already has any quotes</span>
            <span class="c1">#  intact, due to the poorly-specified Netscape Cookie: syntax)</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">cookie</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">non_word_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="ow">and</span> <span class="n">version</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quote_re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">r&quot;</span><span class="se">\\</span><span class="s2">\1&quot;</span><span class="p">,</span> <span class="n">cookie</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">cookie</span><span class="o">.</span><span class="n">value</span>

            <span class="c1"># add cookie-attributes to be returned in Cookie header</span>
            <span class="k">if</span> <span class="n">cookie</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">attrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">version</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cookie</span><span class="o">.</span><span class="n">path_specified</span><span class="p">:</span>
                    <span class="n">attrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;$Path=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">cookie</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cookie</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
                    <span class="n">domain</span> <span class="o">=</span> <span class="n">cookie</span><span class="o">.</span><span class="n">domain</span>
                    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">cookie</span><span class="o">.</span><span class="n">domain_initial_dot</span> <span class="ow">and</span>
                        <span class="n">domain</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)):</span>
                        <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="n">attrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;$Domain=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">domain</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cookie</span><span class="o">.</span><span class="n">port</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="s2">&quot;$Port&quot;</span>
                    <span class="k">if</span> <span class="n">cookie</span><span class="o">.</span><span class="n">port_specified</span><span class="p">:</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">cookie</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
                    <span class="n">attrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">attrs</span></div>

<div class="viewcode-block" id="CookieJar.add_cookie_header"><a class="viewcode-back" href="../generated/generated/cookielib.CookieJar.add_cookie_header.html#cookielib.CookieJar.add_cookie_header">[docs]</a>    <span class="k">def</span> <span class="nf">add_cookie_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add correct Cookie: header to request (urllib2.Request object).</span>

<span class="sd">        The Cookie2 header is also added unless policy.hide_cookie2 is true.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;add_cookie_header&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cookies_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_policy</span><span class="o">.</span><span class="n">_now</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_now</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

            <span class="n">cookies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cookies_for_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

            <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cookie_attrs</span><span class="p">(</span><span class="n">cookies</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">attrs</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">has_header</span><span class="p">(</span><span class="s2">&quot;Cookie&quot;</span><span class="p">):</span>
                    <span class="n">request</span><span class="o">.</span><span class="n">add_unredirected_header</span><span class="p">(</span>
                        <span class="s2">&quot;Cookie&quot;</span><span class="p">,</span> <span class="s2">&quot;; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">attrs</span><span class="p">))</span>

            <span class="c1"># if necessary, advertise that we know RFC 2965</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_policy</span><span class="o">.</span><span class="n">rfc2965</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_policy</span><span class="o">.</span><span class="n">hide_cookie2</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">has_header</span><span class="p">(</span><span class="s2">&quot;Cookie2&quot;</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">cookie</span> <span class="ow">in</span> <span class="n">cookies</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cookie</span><span class="o">.</span><span class="n">version</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">request</span><span class="o">.</span><span class="n">add_unredirected_header</span><span class="p">(</span><span class="s2">&quot;Cookie2&quot;</span><span class="p">,</span> <span class="s1">&#39;$Version=&quot;1&quot;&#39;</span><span class="p">)</span>
                        <span class="k">break</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cookies_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clear_expired_cookies</span><span class="p">()</span></div>

<div class="viewcode-block" id="CookieJar._normalized_cookie_tuples"><a class="viewcode-back" href="../generated/generated/cookielib.CookieJar._normalized_cookie_tuples.html#cookielib.CookieJar._normalized_cookie_tuples">[docs]</a>    <span class="k">def</span> <span class="nf">_normalized_cookie_tuples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs_set</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return list of tuples containing normalised cookie information.</span>

<span class="sd">        attrs_set is the list of lists of key,value pairs extracted from</span>
<span class="sd">        the Set-Cookie or Set-Cookie2 headers.</span>

<span class="sd">        Tuples are name, value, standard, rest, where name and value are the</span>
<span class="sd">        cookie name and value, standard is a dictionary containing the standard</span>
<span class="sd">        cookie-attributes (discard, secure, version, expires or max-age,</span>
<span class="sd">        domain, path and port) and rest is a dictionary containing the rest of</span>
<span class="sd">        the cookie-attributes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cookie_tuples</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">boolean_attrs</span> <span class="o">=</span> <span class="s2">&quot;discard&quot;</span><span class="p">,</span> <span class="s2">&quot;secure&quot;</span>
        <span class="n">value_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;expires&quot;</span><span class="p">,</span> <span class="s2">&quot;max-age&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;domain&quot;</span><span class="p">,</span> <span class="s2">&quot;path&quot;</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;comment&quot;</span><span class="p">,</span> <span class="s2">&quot;commenturl&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">cookie_attrs</span> <span class="ow">in</span> <span class="n">attrs_set</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">cookie_attrs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Build dictionary of standard cookie-attributes (standard) and</span>
            <span class="c1"># dictionary of other cookie-attributes (rest).</span>

            <span class="c1"># Note: expiry time is normalised to seconds since epoch.  V0</span>
            <span class="c1"># cookies should have the Expires cookie-attribute, and V1 cookies</span>
            <span class="c1"># should have Max-Age, but since V1 includes RFC 2109 cookies (and</span>
            <span class="c1"># since V0 cookies may be a mish-mash of Netscape and RFC 2109), we</span>
            <span class="c1"># accept either (but prefer Max-Age).</span>
            <span class="n">max_age_set</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="n">bad_cookie</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="n">standard</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">rest</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">cookie_attrs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">lc</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="c1"># don&#39;t lose case distinction for unknown fields</span>
                <span class="k">if</span> <span class="n">lc</span> <span class="ow">in</span> <span class="n">value_attrs</span> <span class="ow">or</span> <span class="n">lc</span> <span class="ow">in</span> <span class="n">boolean_attrs</span><span class="p">:</span>
                    <span class="n">k</span> <span class="o">=</span> <span class="n">lc</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">boolean_attrs</span> <span class="ow">and</span> <span class="n">v</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="c1"># boolean cookie-attribute is present, but has no value</span>
                    <span class="c1"># (like &quot;discard&quot;, rather than &quot;port=80&quot;)</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">standard</span><span class="p">:</span>
                    <span class="c1"># only first value is significant</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;domain&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   missing value for domain attribute&quot;</span><span class="p">)</span>
                        <span class="n">bad_cookie</span> <span class="o">=</span> <span class="bp">True</span>
                        <span class="k">break</span>
                    <span class="c1"># RFC 2965 section 3.3.3</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;expires&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">max_age_set</span><span class="p">:</span>
                        <span class="c1"># Prefer max-age to expires (like Mozilla)</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   missing or invalid value for expires &quot;</span>
                              <span class="s2">&quot;attribute: treating as session cookie&quot;</span><span class="p">)</span>
                        <span class="k">continue</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;max-age&quot;</span><span class="p">:</span>
                    <span class="n">max_age_set</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   missing or invalid (non-numeric) value for &quot;</span>
                              <span class="s2">&quot;max-age attribute&quot;</span><span class="p">)</span>
                        <span class="n">bad_cookie</span> <span class="o">=</span> <span class="bp">True</span>
                        <span class="k">break</span>
                    <span class="c1"># convert RFC 2965 Max-Age to seconds since epoch</span>
                    <span class="c1"># XXX Strictly you&#39;re supposed to follow RFC 2616</span>
                    <span class="c1">#   age-calculation rules.  Remember that zero Max-Age</span>
                    <span class="c1">#   is a request to discard (old and new) cookie, though.</span>
                    <span class="n">k</span> <span class="o">=</span> <span class="s2">&quot;expires&quot;</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_now</span> <span class="o">+</span> <span class="n">v</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">value_attrs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">boolean_attrs</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span>
                        <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;port&quot;</span><span class="p">,</span> <span class="s2">&quot;comment&quot;</span><span class="p">,</span> <span class="s2">&quot;commenturl&quot;</span><span class="p">)):</span>
                        <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;   missing value for </span><span class="si">%s</span><span class="s2"> attribute&quot;</span> <span class="o">%</span> <span class="n">k</span><span class="p">)</span>
                        <span class="n">bad_cookie</span> <span class="o">=</span> <span class="bp">True</span>
                        <span class="k">break</span>
                    <span class="n">standard</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rest</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

            <span class="k">if</span> <span class="n">bad_cookie</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">cookie_tuples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">standard</span><span class="p">,</span> <span class="n">rest</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">cookie_tuples</span></div>

<div class="viewcode-block" id="CookieJar._cookie_from_cookie_tuple"><a class="viewcode-back" href="../generated/generated/cookielib.CookieJar._cookie_from_cookie_tuple.html#cookielib.CookieJar._cookie_from_cookie_tuple">[docs]</a>    <span class="k">def</span> <span class="nf">_cookie_from_cookie_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tup</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="c1"># standard is dict of standard cookie-attributes, rest is dict of the</span>
        <span class="c1"># rest of them</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">standard</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">tup</span>

        <span class="n">domain</span> <span class="o">=</span> <span class="n">standard</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;domain&quot;</span><span class="p">,</span> <span class="n">Absent</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">standard</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">,</span> <span class="n">Absent</span><span class="p">)</span>
        <span class="n">port</span> <span class="o">=</span> <span class="n">standard</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;port&quot;</span><span class="p">,</span> <span class="n">Absent</span><span class="p">)</span>
        <span class="n">expires</span> <span class="o">=</span> <span class="n">standard</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;expires&quot;</span><span class="p">,</span> <span class="n">Absent</span><span class="p">)</span>

        <span class="c1"># set the easy defaults</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">standard</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">version</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>  <span class="c1"># invalid version, ignore cookie</span>
        <span class="n">secure</span> <span class="o">=</span> <span class="n">standard</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;secure&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="c1"># (discard is also set if expires is Absent)</span>
        <span class="n">discard</span> <span class="o">=</span> <span class="n">standard</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;discard&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">comment</span> <span class="o">=</span> <span class="n">standard</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;comment&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">comment_url</span> <span class="o">=</span> <span class="n">standard</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;commenturl&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="c1"># set default path</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Absent</span> <span class="ow">and</span> <span class="n">path</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">path_specified</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">escape_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">path_specified</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">request_path</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># Netscape spec parts company from reality here</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span>

        <span class="c1"># set default domain</span>
        <span class="n">domain_specified</span> <span class="o">=</span> <span class="n">domain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Absent</span>
        <span class="c1"># but first we have to remember whether it starts with a dot</span>
        <span class="n">domain_initial_dot</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">domain_specified</span><span class="p">:</span>
            <span class="n">domain_initial_dot</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">domain</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">domain</span> <span class="ow">is</span> <span class="n">Absent</span><span class="p">:</span>
            <span class="n">req_host</span><span class="p">,</span> <span class="n">erhn</span> <span class="o">=</span> <span class="n">eff_request_host</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="n">erhn</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">domain</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="n">domain</span>

        <span class="c1"># set default port</span>
        <span class="n">port_specified</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">port</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Absent</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">port</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c1"># Port attr present, but has no value: default to request port.</span>
                <span class="c1"># Cookie should then only be sent back on that port.</span>
                <span class="n">port</span> <span class="o">=</span> <span class="n">request_port</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">port_specified</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">port</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">r&quot;\s+&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># No port attr present.  Cookie can be sent back on any port.</span>
            <span class="n">port</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c1"># set default expires and discard</span>
        <span class="k">if</span> <span class="n">expires</span> <span class="ow">is</span> <span class="n">Absent</span><span class="p">:</span>
            <span class="n">expires</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">discard</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">expires</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_now</span><span class="p">:</span>
            <span class="c1"># Expiry date in past is request to delete cookie.  This can&#39;t be</span>
            <span class="c1"># in DefaultCookiePolicy, because can&#39;t delete cookies there.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;Expiring cookie, domain=&#39;</span><span class="si">%s</span><span class="s2">&#39;, path=&#39;</span><span class="si">%s</span><span class="s2">&#39;, name=&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
                   <span class="n">domain</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="k">return</span> <span class="n">Cookie</span><span class="p">(</span><span class="n">version</span><span class="p">,</span>
                      <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span>
                      <span class="n">port</span><span class="p">,</span> <span class="n">port_specified</span><span class="p">,</span>
                      <span class="n">domain</span><span class="p">,</span> <span class="n">domain_specified</span><span class="p">,</span> <span class="n">domain_initial_dot</span><span class="p">,</span>
                      <span class="n">path</span><span class="p">,</span> <span class="n">path_specified</span><span class="p">,</span>
                      <span class="n">secure</span><span class="p">,</span>
                      <span class="n">expires</span><span class="p">,</span>
                      <span class="n">discard</span><span class="p">,</span>
                      <span class="n">comment</span><span class="p">,</span>
                      <span class="n">comment_url</span><span class="p">,</span>
                      <span class="n">rest</span><span class="p">)</span></div>

<div class="viewcode-block" id="CookieJar._cookies_from_attrs_set"><a class="viewcode-back" href="../generated/generated/cookielib.CookieJar._cookies_from_attrs_set.html#cookielib.CookieJar._cookies_from_attrs_set">[docs]</a>    <span class="k">def</span> <span class="nf">_cookies_from_attrs_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs_set</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">cookie_tuples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalized_cookie_tuples</span><span class="p">(</span><span class="n">attrs_set</span><span class="p">)</span>

        <span class="n">cookies</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">cookie_tuples</span><span class="p">:</span>
            <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cookie_from_cookie_tuple</span><span class="p">(</span><span class="n">tup</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cookie</span><span class="p">:</span> <span class="n">cookies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cookie</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cookies</span></div>

<div class="viewcode-block" id="CookieJar._process_rfc2109_cookies"><a class="viewcode-back" href="../generated/generated/cookielib.CookieJar._process_rfc2109_cookies.html#cookielib.CookieJar._process_rfc2109_cookies">[docs]</a>    <span class="k">def</span> <span class="nf">_process_rfc2109_cookies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cookies</span><span class="p">):</span>
        <span class="n">rfc2109_as_ns</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_policy</span><span class="p">,</span> <span class="s1">&#39;rfc2109_as_netscape&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rfc2109_as_ns</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">rfc2109_as_ns</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_policy</span><span class="o">.</span><span class="n">rfc2965</span>
        <span class="k">for</span> <span class="n">cookie</span> <span class="ow">in</span> <span class="n">cookies</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cookie</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">cookie</span><span class="o">.</span><span class="n">rfc2109</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">if</span> <span class="n">rfc2109_as_ns</span><span class="p">:</span>
                    <span class="c1"># treat 2109 cookies as Netscape cookies rather than</span>
                    <span class="c1"># as RFC2965 cookies</span>
                    <span class="n">cookie</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="CookieJar.make_cookies"><a class="viewcode-back" href="../generated/generated/cookielib.CookieJar.make_cookies.html#cookielib.CookieJar.make_cookies">[docs]</a>    <span class="k">def</span> <span class="nf">make_cookies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return sequence of Cookie objects extracted from response object.&quot;&quot;&quot;</span>
        <span class="c1"># get cookie-attributes for RFC 2965 and Netscape protocols</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="n">rfc2965_hdrs</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">getheaders</span><span class="p">(</span><span class="s2">&quot;Set-Cookie2&quot;</span><span class="p">)</span>
        <span class="n">ns_hdrs</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">getheaders</span><span class="p">(</span><span class="s2">&quot;Set-Cookie&quot;</span><span class="p">)</span>

        <span class="n">rfc2965</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_policy</span><span class="o">.</span><span class="n">rfc2965</span>
        <span class="n">netscape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_policy</span><span class="o">.</span><span class="n">netscape</span>

        <span class="k">if</span> <span class="p">((</span><span class="ow">not</span> <span class="n">rfc2965_hdrs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ns_hdrs</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">ns_hdrs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">rfc2965</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">rfc2965_hdrs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">netscape</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">netscape</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">rfc2965</span><span class="p">)):</span>
            <span class="k">return</span> <span class="p">[]</span>  <span class="c1"># no relevant cookie headers: quick exit</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">cookies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cookies_from_attrs_set</span><span class="p">(</span>
                <span class="n">split_header_words</span><span class="p">(</span><span class="n">rfc2965_hdrs</span><span class="p">),</span> <span class="n">request</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">_warn_unhandled_exception</span><span class="p">()</span>
            <span class="n">cookies</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">ns_hdrs</span> <span class="ow">and</span> <span class="n">netscape</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># RFC 2109 and Netscape cookies</span>
                <span class="n">ns_cookies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cookies_from_attrs_set</span><span class="p">(</span>
                    <span class="n">parse_ns_headers</span><span class="p">(</span><span class="n">ns_hdrs</span><span class="p">),</span> <span class="n">request</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">_warn_unhandled_exception</span><span class="p">()</span>
                <span class="n">ns_cookies</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process_rfc2109_cookies</span><span class="p">(</span><span class="n">ns_cookies</span><span class="p">)</span>

            <span class="c1"># Look for Netscape cookies (from Set-Cookie headers) that match</span>
            <span class="c1"># corresponding RFC 2965 cookies (from Set-Cookie2 headers).</span>
            <span class="c1"># For each match, keep the RFC 2965 cookie and ignore the Netscape</span>
            <span class="c1"># cookie (RFC 2965 section 9.1).  Actually, RFC 2109 cookies are</span>
            <span class="c1"># bundled in with the Netscape cookies for this purpose, which is</span>
            <span class="c1"># reasonable behaviour.</span>
            <span class="k">if</span> <span class="n">rfc2965</span><span class="p">:</span>
                <span class="n">lookup</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">cookie</span> <span class="ow">in</span> <span class="n">cookies</span><span class="p">:</span>
                    <span class="n">lookup</span><span class="p">[(</span><span class="n">cookie</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="n">cookie</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">cookie</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">None</span>

                <span class="k">def</span> <span class="nf">no_matching_rfc2965</span><span class="p">(</span><span class="n">ns_cookie</span><span class="p">,</span> <span class="n">lookup</span><span class="o">=</span><span class="n">lookup</span><span class="p">):</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">ns_cookie</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="n">ns_cookie</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">ns_cookie</span><span class="o">.</span><span class="n">name</span>
                    <span class="k">return</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lookup</span>
                <span class="n">ns_cookies</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="n">no_matching_rfc2965</span><span class="p">,</span> <span class="n">ns_cookies</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ns_cookies</span><span class="p">:</span>
                <span class="n">cookies</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ns_cookies</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cookies</span></div>

<div class="viewcode-block" id="CookieJar.set_cookie_if_ok"><a class="viewcode-back" href="../generated/generated/cookielib.CookieJar.set_cookie_if_ok.html#cookielib.CookieJar.set_cookie_if_ok">[docs]</a>    <span class="k">def</span> <span class="nf">set_cookie_if_ok</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cookie</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set a cookie if policy says it&#39;s OK to do so.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cookies_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_policy</span><span class="o">.</span><span class="n">_now</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_now</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_policy</span><span class="o">.</span><span class="n">set_ok</span><span class="p">(</span><span class="n">cookie</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="n">cookie</span><span class="p">)</span>


        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cookies_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span></div>

<div class="viewcode-block" id="CookieJar.set_cookie"><a class="viewcode-back" href="../generated/generated/cookielib.CookieJar.set_cookie.html#cookielib.CookieJar.set_cookie">[docs]</a>    <span class="k">def</span> <span class="nf">set_cookie</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cookie</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set a cookie, without checking whether or not it should be set.&quot;&quot;&quot;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cookies_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cookie</span><span class="o">.</span><span class="n">domain</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="n">cookie</span><span class="o">.</span><span class="n">domain</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">c2</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">cookie</span><span class="o">.</span><span class="n">domain</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">cookie</span><span class="o">.</span><span class="n">path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c2</span><span class="p">:</span> <span class="n">c2</span><span class="p">[</span><span class="n">cookie</span><span class="o">.</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">c3</span> <span class="o">=</span> <span class="n">c2</span><span class="p">[</span><span class="n">cookie</span><span class="o">.</span><span class="n">path</span><span class="p">]</span>
            <span class="n">c3</span><span class="p">[</span><span class="n">cookie</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cookie</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cookies_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span></div>

<div class="viewcode-block" id="CookieJar.extract_cookies"><a class="viewcode-back" href="../generated/generated/cookielib.CookieJar.extract_cookies.html#cookielib.CookieJar.extract_cookies">[docs]</a>    <span class="k">def</span> <span class="nf">extract_cookies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Extract cookies from response, where allowable given the request.&quot;&quot;&quot;</span>
        <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot;extract_cookies: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cookies_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_policy</span><span class="o">.</span><span class="n">_now</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_now</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

            <span class="k">for</span> <span class="n">cookie</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_cookies</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_policy</span><span class="o">.</span><span class="n">set_ok</span><span class="p">(</span><span class="n">cookie</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
                    <span class="n">_debug</span><span class="p">(</span><span class="s2">&quot; setting cookie: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="n">cookie</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cookies_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span></div>

<div class="viewcode-block" id="CookieJar.clear"><a class="viewcode-back" href="../generated/generated/cookielib.CookieJar.clear.html#cookielib.CookieJar.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear some cookies.</span>

<span class="sd">        Invoking this method without arguments will clear all cookies.  If</span>
<span class="sd">        given a single argument, only cookies belonging to that domain will be</span>
<span class="sd">        removed.  If given two arguments, cookies belonging to the specified</span>
<span class="sd">        path within that domain are removed.  If given three arguments, then</span>
<span class="sd">        the cookie with the specified name, path and domain is removed.</span>

<span class="sd">        Raises KeyError if no matching cookie exists.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">domain</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;domain and path must be given to remove a cookie by name&quot;</span><span class="p">)</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="n">domain</span><span class="p">][</span><span class="n">path</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">domain</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;domain must be given to remove cookies by path&quot;</span><span class="p">)</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="n">domain</span><span class="p">][</span><span class="n">path</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">domain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="CookieJar.clear_session_cookies"><a class="viewcode-back" href="../generated/generated/cookielib.CookieJar.clear_session_cookies.html#cookielib.CookieJar.clear_session_cookies">[docs]</a>    <span class="k">def</span> <span class="nf">clear_session_cookies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Discard all session cookies.</span>

<span class="sd">        Note that the .save() method won&#39;t save session cookies anyway, unless</span>
<span class="sd">        you ask otherwise by passing a true ignore_discard argument.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cookies_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cookie</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cookie</span><span class="o">.</span><span class="n">discard</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="n">cookie</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">cookie</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cookies_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span></div>

<div class="viewcode-block" id="CookieJar.clear_expired_cookies"><a class="viewcode-back" href="../generated/generated/cookielib.CookieJar.clear_expired_cookies.html#cookielib.CookieJar.clear_expired_cookies">[docs]</a>    <span class="k">def</span> <span class="nf">clear_expired_cookies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Discard all expired cookies.</span>

<span class="sd">        You probably don&#39;t need to call this method: expired cookies are never</span>
<span class="sd">        sent back to the server (provided you&#39;re using DefaultCookiePolicy),</span>
<span class="sd">        this method is called by CookieJar itself every so often, and the</span>
<span class="sd">        .save() method won&#39;t save expired cookies anyway (unless you ask</span>
<span class="sd">        otherwise by passing a true ignore_expires argument).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cookies_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">cookie</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cookie</span><span class="o">.</span><span class="n">is_expired</span><span class="p">(</span><span class="n">now</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="n">cookie</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">cookie</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cookies_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span></div>

<div class="viewcode-block" id="CookieJar.__iter__"><a class="viewcode-back" href="../generated/generated/cookielib.CookieJar.__iter__.html#cookielib.CookieJar.__iter__">[docs]</a>    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">deepvalues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span><span class="p">)</span></div>

<div class="viewcode-block" id="CookieJar.__len__"><a class="viewcode-back" href="../generated/generated/cookielib.CookieJar.__len__.html#cookielib.CookieJar.__len__">[docs]</a>    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return number of contained cookies.&quot;&quot;&quot;</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">cookie</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span> <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">i</span></div>

<div class="viewcode-block" id="CookieJar.__repr__"><a class="viewcode-back" href="../generated/generated/cookielib.CookieJar.__repr__.html#cookielib.CookieJar.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cookie</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">cookie</span><span class="p">))</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2">[</span><span class="si">%s</span><span class="s2">]&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">r</span><span class="p">))</span></div>

<div class="viewcode-block" id="CookieJar.__str__"><a class="viewcode-back" href="../generated/generated/cookielib.CookieJar.__str__.html#cookielib.CookieJar.__str__">[docs]</a>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cookie</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cookie</span><span class="p">))</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2">[</span><span class="si">%s</span><span class="s2">]&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">r</span><span class="p">))</span></div></div>


<span class="c1"># derives from IOError for backwards-compatibility with Python 2.4.0</span>
<div class="viewcode-block" id="LoadError"><a class="viewcode-back" href="../generated/cookielib.LoadError.html#cookielib.LoadError">[docs]</a><span class="k">class</span> <span class="nc">LoadError</span><span class="p">(</span><span class="ne">IOError</span><span class="p">):</span> <span class="k">pass</span></div>

<div class="viewcode-block" id="FileCookieJar"><a class="viewcode-back" href="../generated/generated/cookielib.FileCookieJar.html#cookielib.FileCookieJar">[docs]</a><span class="k">class</span> <span class="nc">FileCookieJar</span><span class="p">(</span><span class="n">CookieJar</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;CookieJar that can be loaded from and saved to a file.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="FileCookieJar.__init__"><a class="viewcode-back" href="../generated/generated/cookielib.FileCookieJar.__init__.html#cookielib.FileCookieJar.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">delayload</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">policy</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cookies are NOT loaded from the named file until either the .load() or</span>
<span class="sd">        .revert() method is called.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">CookieJar</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">policy</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">filename</span><span class="o">+</span><span class="s2">&quot;&quot;</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;filename must be string-like&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delayload</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">delayload</span><span class="p">)</span></div>

<div class="viewcode-block" id="FileCookieJar.save"><a class="viewcode-back" href="../generated/generated/cookielib.FileCookieJar.save.html#cookielib.FileCookieJar.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ignore_discard</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ignore_expires</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save cookies to a file.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="FileCookieJar.load"><a class="viewcode-back" href="../generated/generated/cookielib.FileCookieJar.load.html#cookielib.FileCookieJar.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ignore_discard</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ignore_expires</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load cookies from a file.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span>
            <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">MISSING_FILENAME_TEXT</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_really_load</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">ignore_discard</span><span class="p">,</span> <span class="n">ignore_expires</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="FileCookieJar.revert"><a class="viewcode-back" href="../generated/generated/cookielib.FileCookieJar.revert.html#cookielib.FileCookieJar.revert">[docs]</a>    <span class="k">def</span> <span class="nf">revert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
               <span class="n">ignore_discard</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ignore_expires</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear all cookies and reload cookies from a saved file.</span>

<span class="sd">        Raises LoadError (or IOError) if reversion is not successful; the</span>
<span class="sd">        object&#39;s state will not be altered if this happens.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span>
            <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">MISSING_FILENAME_TEXT</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_cookies_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="n">old_state</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">ignore_discard</span><span class="p">,</span> <span class="n">ignore_expires</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">LoadError</span><span class="p">,</span> <span class="ne">IOError</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span> <span class="o">=</span> <span class="n">old_state</span>
                <span class="k">raise</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cookies_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span></div></div>

<span class="kn">from</span> <span class="nn">_LWPCookieJar</span> <span class="kn">import</span> <span class="n">LWPCookieJar</span><span class="p">,</span> <span class="n">lwp_cookie_str</span>
<span class="kn">from</span> <span class="nn">_MozillaCookieJar</span> <span class="kn">import</span> <span class="n">MozillaCookieJar</span>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/copybutton.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>