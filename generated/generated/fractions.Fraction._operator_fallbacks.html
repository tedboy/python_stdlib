

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>fractions.Fraction._operator_fallbacks &mdash; Python Standard Library</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/py.png"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Python Standard Library" href="../../index.html"/>
        <link rel="up" title="fractions.Fraction" href="fractions.Fraction.html"/>
        <link rel="next" title="fractions.Fraction._richcmp" href="fractions.Fraction._richcmp.html"/>
        <link rel="prev" title="fractions.Fraction._mul" href="fractions.Fraction._mul.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Python Standard Library
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../01to10.html">Ch 01 - 10</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../11to20.html">Ch 11 - 20</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../21to30.html">Ch 21 - 30</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../31to37.html">Ch 31 - 37</a></li>
</ul>
<p class="caption"><span class="caption-text">Autogenerated API</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../api_06to10.html">API: 06 - 10</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../api_06to10.html#built-in-exceptions">06 Built-in Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_06to10.html#string-services">07 String Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_06to10.html#data-types">08 Data Types</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../api_06to10.html#numeric-and-mathematical-methods">09 Numeric and Mathematical Methods</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../numbers.html"><code class="docutils literal"><span class="pre">numbers</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../math.html"><code class="docutils literal"><span class="pre">math</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmath.html"><code class="docutils literal"><span class="pre">cmath</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../decimal.html"><code class="docutils literal"><span class="pre">decimal</span></code></a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../fractions.html"><code class="docutils literal"><span class="pre">fractions</span></code></a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../fractions.html#functions">Functions</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../fractions.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../random.html"><code class="docutils literal"><span class="pre">random</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../itertools.html"><code class="docutils literal"><span class="pre">itertools</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../functools.html"><code class="docutils literal"><span class="pre">functools</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../operator.html"><code class="docutils literal"><span class="pre">operator</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api_06to10.html#file-and-directory-access">10 File and Directory Access</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api_11to15.html">API: 11 - 15</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_16to20.html">API: 16 - 20</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_21to25.html">API: 21 - 25</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_26to30.html">API: 26 - 30</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_31to37.html">API: 31 - 37</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Python Standard Library</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          













<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../api_06to10.html">API: 06 - 10</a> &raquo;</li>
        
          <li><a href="../fractions.html"><code class="docutils literal"><span class="pre">fractions</span></code></a> &raquo;</li>
        
          <li><a href="fractions.Fraction.html"><code class="docutils literal"><span class="pre">fractions.Fraction</span></code></a> &raquo;</li>
        
      <li>fractions.Fraction._operator_fallbacks</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/generated/generated/fractions.Fraction._operator_fallbacks.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="fractions-fraction-operator-fallbacks">
<h1>fractions.Fraction._operator_fallbacks<a class="headerlink" href="#fractions-fraction-operator-fallbacks" title="Permalink to this headline">¶</a></h1>
<dl class="method">
<dt id="fractions.Fraction._operator_fallbacks">
<code class="descclassname">Fraction.</code><code class="descname">_operator_fallbacks</code><span class="sig-paren">(</span><em>monomorphic_operator</em>, <em>fallback_operator</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/fractions.html#Fraction._operator_fallbacks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#fractions.Fraction._operator_fallbacks" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates forward and reverse operators given a purely-rational
operator and a function from the operator module.</p>
<p>Use this like:
__op__, __rop__ = _operator_fallbacks(just_rational_op, operator.op)</p>
<p>In general, we want to implement the arithmetic operations so
that mixed-mode operations either call an implementation whose
author knew about the types of both arguments, or convert both
to the nearest built in type and do the operation there. In
Fraction, that means that we define __add__ and __radd__ as:</p>
<blockquote>
<div><dl class="docutils">
<dt>def __add__(self, other):</dt>
<dd><p class="first"># Both types have numerators/denominator attributes,
# so do the operation directly
if isinstance(other, (int, long, Fraction)):</p>
<blockquote>
<div><dl class="docutils">
<dt>return Fraction(self.numerator * other.denominator +</dt>
<dd>other.numerator * self.denominator,
self.denominator * other.denominator)</dd>
</dl>
</div></blockquote>
<p># float and complex don&#8217;t have those operations, but we
# know about those types, so special case them.
elif isinstance(other, float):</p>
<blockquote>
<div>return float(self) + other</div></blockquote>
<dl class="docutils">
<dt>elif isinstance(other, complex):</dt>
<dd>return complex(self) + other</dd>
</dl>
<p class="last"># Let the other type take over.
return NotImplemented</p>
</dd>
<dt>def __radd__(self, other):</dt>
<dd><p class="first"># radd handles more types than add because there&#8217;s
# nothing left to fall back to.
if isinstance(other, Rational):</p>
<blockquote>
<div><dl class="docutils">
<dt>return Fraction(self.numerator * other.denominator +</dt>
<dd>other.numerator * self.denominator,
self.denominator * other.denominator)</dd>
</dl>
</div></blockquote>
<dl class="docutils">
<dt>elif isinstance(other, Real):</dt>
<dd>return float(other) + float(self)</dd>
<dt>elif isinstance(other, Complex):</dt>
<dd>return complex(other) + complex(self)</dd>
</dl>
<p class="last">return NotImplemented</p>
</dd>
</dl>
</div></blockquote>
<p>There are 5 different cases for a mixed-type addition on
Fraction. I&#8217;ll refer to all of the above code that doesn&#8217;t
refer to Fraction, float, or complex as &#8220;boilerplate&#8221;. &#8216;r&#8217;
will be an instance of Fraction, which is a subtype of
Rational (r : Fraction &lt;: Rational), and b : B &lt;:
Complex. The first three involve &#8216;r + b&#8217;:</p>
<blockquote>
<div><ol class="arabic simple">
<li>If B &lt;: Fraction, int, float, or complex, we handle
that specially, and all is well.</li>
<li>If Fraction falls back to the boilerplate code, and it
were to return a value from __add__, we&#8217;d miss the
possibility that B defines a more intelligent __radd__,
so the boilerplate should return NotImplemented from
__add__. In particular, we don&#8217;t handle Rational
here, even though we could get an exact answer, in case
the other type wants to do something special.</li>
<li>If B &lt;: Fraction, Python tries B.__radd__ before
Fraction.__add__. This is ok, because it was
implemented with knowledge of Fraction, so it can
handle those instances before delegating to Real or
Complex.</li>
</ol>
</div></blockquote>
<p>The next two situations describe &#8216;b + r&#8217;. We assume that b
didn&#8217;t know about Fraction in its implementation, and that it
uses similar boilerplate code:</p>
<blockquote>
<div><ol class="arabic simple" start="4">
<li>If B &lt;: Rational, then __radd_ converts both to the
builtin rational type (hey look, that&#8217;s us) and
proceeds.</li>
<li>Otherwise, __radd__ tries to find the nearest common
base ABC, and fall back to its builtin type. Since this
class doesn&#8217;t subclass a concrete type, there&#8217;s no
implementation to fall back to, so we need to try as
hard as possible to return an actual value, or the user
will get a TypeError.</li>
</ol>
</div></blockquote>
</dd></dl>

</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="fractions.Fraction._richcmp.html" class="btn btn-neutral float-right" title="fractions.Fraction._richcmp" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="fractions.Fraction._mul.html" class="btn btn-neutral" title="fractions.Fraction._mul" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/copybutton.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>